
+++
date = "2017-06-29 03:04:57 +0000 UTC"
draft = false
title = "ASP.NET Core MVC で RSS を出力する（適当版）"
tags = ["ASP.NET Core"]

+++
[空の ASP.NET Core プロジェクトからとりあえず Web サイトのトップページを書いて Azure にデプロイするまで - だるろぐ](http://blog.daruyanagi.jp/entry/2017/06/27/021736)前回は ASP.NET Web Pages のサイトを、付け焼き刃で ASP.NET Core MVC に移植しました。でも、WebMatrix で作ったフィード配信機能が動作しない……。[WebMatrix 3: RSS フィードを出力する - だるろぐ](http://blog.daruyanagi.jp/entry/2013/04/17/065153)[WebMatrix 3: RSS フィードを出力する（解決編） - だるろぐ](http://blog.daruyanagi.jp/entry/2013/04/18/031339)というわけで、こっちも簡易的な対策を行いました。ちょっと調べた限りでは、

<ul>
<li>Response は使えない → Context.Response を代わりに使う</li>
<li>System.ServiceModel.Syndication は .NET Core 1.1 で実装されていない → 自分で XML を組み立てる</li>
</ul>でイケそう。というわけで、まずはモデルっぽいもの（/Models/FeedItem.cs）を準備。
```cs
public class FeedItem
{
    public string Link { get; set; }
    public string Title { get; set; }
    public HtmlString Content { get; set; }
    public DateTime PublishDate { get; set; }
}

```次にコントローラー（/Controllers/FeedController.cs）を作成。
```cs
public class FeedController : Controller
{
    public async Task&lt;IActionResult> Index()
    {
        var feeds = new List&lt;FeedItem>();
        // FeedItem を適当に Add() してね！
        return View(feeds);
    }
}

```最後にビュー（/Views/Feed/Index.cshtml）を作成。今回は Atom で出力してみました。
```cs
@model IList&lt;FeedItem>

@{
    Context.Response.ContentType = "application/xml";

    var title = "daruyanagi.jp";
    var link = "https://blog.daruyanagi.jp/";
}

&lt;feed xmlns="http://www.w3.org/2005/Atom" xml:lang="ja">
    &lt;title>@title&lt;/title>
    &lt;link href="@link" />
    &lt;id>@link&lt;/id>
    @foreach (var item in Model)
    {
        &lt;entry>
            &lt;title>@item.Title&lt;/title>
            &lt;link href="@item.Link" />
            &lt;id>@item.Link&lt;/id>
            &lt;published>@item.PublishDate.ToString("yyyy-MM-dd&#39;T&#39;HH:mm:ss.fffK")&lt;/published>
        &lt;/entry>
    }
&lt;/feed>

```簡易的な対策ですけど、まぁ、ちゃんと動いているので当面はこれでよし。

{{< figure src="/images/20170629030059.png"  >}}

しい作法ではない気がしますが（ちゃんとフレームワークでやり方が用意されているかも？）、自己流なりに要領をつかめてきた感じで嬉しいです。ほんとは ASP.NET Web Pages で気軽にやりたいんだけど……調べてみたらそろそろ準備が整いつつあるみたいなので楽しみ。

>https://t.co/8bABHDpik7 Web Pages の後継っぽいものに Razer Pages（？）っていうのがあって、次期 VS の Update でツールサポートが付くということを理解したところで、この件に関しては休眠 Zzz……— だるやなぎ に天使が舞い降りた！ (@daruyanagi) 2017年6月28日<script async="" src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>


