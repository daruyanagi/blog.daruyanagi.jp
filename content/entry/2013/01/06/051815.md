
+++
date = "2013-01-06 05:18:15 +0000 UTC"
draft = false
title = "WebMatrix 2 / Razor：switch と RenderPage()"
tags = ["ASP.net Web Pages","WebMatrix"]

+++
{{< figure src="/images/20130106043226.png"  >}}たとえば、

<ul>
<li>~/Posts/ …… ページリストの表示</li>
<li>~/Posts/:id …… 個別ページの表示</li>
</ul>というのをやってみたいとき。

<ul>
<li>~/Posts/Default.cshtml</li>
</ul>を作成して、

<ul>
<li>UrlData.Count() == 0 ……ページリストの表示</li>
<li>UrlData.Count() == 1 ……個別ページの表示</li>
</ul>という処理を書けばいいよね（<a href="https://blog.daruyanagi.jp/entry/2012/07/06/174414">WebMatrix のルーティング - だるろぐ</a>）。こういう処理は if で分岐してもいいのだけど、将来的に UrlData.Count() >= 2 の処理を書くことも考えて switch にするのが個人的には好み。いかにも「処理を切り替えています！」みたいな感じで。でも、そういえば Razor で switch って書いたことないな。どうやって書くんだろう。
```cs
@{
    var db = Database.Open("db");
    var query = "SELECT * FROM Post ORDER BY CreatedAt DESC";
    var posts = db.Query(query);
}

@switch (UrlData.Count)
{
    case 0:
        foreach (var post in posts)
        {
            @RenderPage("_Single.cshtml", post)
        }
        break;
    default:
        @RenderPage("_Single.cshtml", posts.First())
        break;
}

```……と思ったけど普通に書いて動いた。{{< figure src="/images/20130106050950.png"  >}}リストの時は _Single.cshtml のレンダリングを foreach で回して、個別ページの時は一度だけ出力する。_Single.cshtml は何度も使う単一 Post の表示を切り出したもので、**部分ビュー**と呼んだりもするのだけど、内容はこんな適当な感じ。
```cs
@{
    var post = PageData.First().Value;
}

&lt;div>
    &lt;header>
        &lt;h1>@post.Title&lt;/h1>
        &lt;p>@post.CreatedAt&lt;/p>
    &lt;/header>
    &lt;article>
        @post.Body
    &lt;/article>
    &lt;footer>
        &lt;ul>
            &lt;li>&lt;a href="@post.Id">Show&lt;/a>&lt;/li>
            &lt;li>&lt;a href="Edit/@post.Id">Edit&lt;/a>&lt;/li>
            &lt;li>&lt;a href="Delete/@post.Id">Delete&lt;/a>&lt;/li>
        &lt;/ul>
    &lt;/footer>
&lt;/div>

```RenderPage() を使ったデータの受け渡しがいまいちよくわからなかったのだけど、PostData を介しているみたいで、PageData.First() と書いたらなんとなく動いた。とはいえ、PageData / Page はいろんなところで便利に使っちゃったりする。上書きなどの汚染がちょっと怖いかもしれない。念のため Visual Studio でなかをのぞいてみた。{{< figure src="/images/20130106050116.png"  >}}RenderPage(…, post, 1, 2) と渡してみたのだけど、params の key は順に 0、1、2 とふられるみたい。なので、Page.Title = "hoge"; といった感じで使う分には問題がなさそう。PageData[0] で post がとれるはず。まぁ、わざわざ上書きしたらこの限りではないと思うけれど。

<div class="section">
    ### 注意
    ```cs
@switch (UrlData.Count)
{
    case 0:
        foreach (var post in posts)
        {
            RenderPage("_Single.cshtml", post);
        }
        break;
    default:
        RenderPage("_Single.cshtml", posts.First());
        break;
}

```一応これでもコンパイルは通るのだけど、RenderPage() は動かない。@RenderPage() って書かなきゃいけないんだね<a href="#f-4e69f321" name="fn-4e69f321" title="文末の ; は不要になる">*1</a>。ここら辺はまだわかるようでよくわかっていないところ。

</div><div class="footnote">
<a href="#fn-4e69f321" name="f-4e69f321" class="footnote-number">*1</a><span class="footnote-delimiter">:</span><span class="footnote-text">文末の ; は不要になる</span>
</div>

