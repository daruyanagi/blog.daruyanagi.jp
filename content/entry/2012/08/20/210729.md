
+++
date = "2012-08-20 21:07:29 +0000 UTC"
draft = false
title = "WebMatrix でファイルのアップロード（2） の補足"
tags = ["ASP.net Web Pages","WebMatrix"]

+++


{{< figure src="/images/20120820014842.png"  >}}

br/>


    >
        デカいファイルをアップロードしようとすると発生するのだけれど、この例外をトラップするのが面倒……。無理やり頑張ってトラップしてみたのだけれど、 try 文がやたらネストするし、 Request に少しでもアクセスしようものなら発生するので IsAjax が取れずに少し困っている。

        WebMatrix でファイルのアップロード（2） - だるろぐ
    
思いついたのだけれど、無理してビューまたは Json を返そうとしなくてもステータスコードだけ返せばいいな。最初にわざとエラーを発生させるコードを書いてそこで return してしまえば、 try……catch 文のネストを減らせるし。
```cs
@{
    try // Catch Request-too-long Error
    {
        var dummy = Request.Files;
    }
    catch (Exception e)
    {
        Response.StatusCode = 
            (int) HttpStatusCode.InternalServerError;
        Response.Write(e.Message);
        return;
    }

    if (IsPost)
    {
        ：
        ：

```これをするとどうなるのかというと、

{{< figure src="/images/20120820210027.png"  >}}

ず、デカいファイルを投げる（既定では約4MB以上）。

{{< figure src="/images/20120820210114.png"  >}}

ーバーでエラーが発生し、ステータスコード（よくわからんけど5**）を返す。

{{< figure src="/images/20120820210207.png"  >}}

.ajax() の error プロパティでそれを拾って……

{{< figure src="/images/20120820014842.png"  >}}

TML を更新する。ブラウザーからアクセスしたときは、まぁ、なんかエラー画面が表示されるのだろう。とりあえずこれでいいか。


