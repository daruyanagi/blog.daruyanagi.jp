
+++
date = "2012-07-06 03:19:03 +0000 UTC"
draft = false
title = "Packets larger than max_allowed_packet are not allowed"
tags = ["WebMatrix","MySQL"]

+++
昨日（<a href="http://daruyanagi.hatenablog.com/entry/2012/07/05/015015">XREA/CoreServer の WordPress を Windows Azure Websites に移植してみる → あと一歩まで行けた - だるろぐ</a>、<a href="http://daruyanagi.hatenablog.com/entry/2012/07/05/022927">XREA/CoreServer の WordPress を Windows Azure Websites に移植してみる → 成功！ - だるろぐ</a>）は XREA でホスティングしていた WordPress を WebMatrix で

    >
        （XREA → ）Windows 8（WebMatrix） → Azure

    
することに成功したので、今日は

    >
        Azure → Windows 7（WebMatrix）

    
を試してみることにした。 Windows 8 環境はよくフリーズするので、あまりサーバーをイジる作業をしたくない。すると、なんとまた失敗。「Packets larger than max_allowed_packet are not allowed」という見覚えのあるエラーが。
```
ERROR: リモート データベースをダウンロードできません。詳細については、"http://go.microsoft.com/fwlink/?LinkId=205387" を参照してください
2:25:59: リモート データベースをダウンロードできません。詳細については、"http://go.microsoft.com/fwlink/?LinkId=205387" を参照してください
2:25:59: 発行済みサイトをダウンロードできません。 リモート データベースをダウンロードできません。詳細については、"http://go.microsoft.com/fwlink/?LinkId=205387" を参照してください
2:25:59: エラーの詳細:
2:25:59: An error occurred during execution of the database script. The error occurred between the following lines of the script: "199" and "211". The verbose log might have more information about the error. The command started with the following:
2:25:59: "--
-- Dumping data for table `wp_postmeta`
--

LOC"
2:25:59:  Packets larger than max_allowed_packet are not allowed. http://go.microsoft.com/fwlink/?LinkId=178587  Learn more at: http://go.microsoft.com/fwlink/?LinkId=221672#ERROR_SQL_EXECUTION_FAILURE.
:
:
```昨日（<a href="http://daruyanagi.hatenablog.com/entry/2012/07/05/022927">XREA/CoreServer の WordPress を Windows Azure Websites に移植してみる → 成功！ - だるろぐ</a>）は不要なテーブルを削除して回避したのだけど、今回はその手が使えない<a href="#f1" name="fn1" title="wp_postmeta を消したらいろいろ吹っ飛びそうだ">*1</a>。まぁ、今回は Azure → ローカル の話なので、ローカルにある MySQL の設定を直接イジって max_allowed_packet を増やしてあげればよさそうだ。<img src="http://cdn-ak.f.st-hatena.com/images/fotolife/d/daruyanagi/20120706/20120706031259.png" alt="f:id:daruyanagi:20120706031259p:plain" title="f:id:daruyanagi:20120706031259p:plain" class="hatena-fotolife"/>初期状態では 1MB となっていたので、これを 16MB 程度に増やしてあげる。インストールフォルダにある“my.ini”の [mysqld] セクションに以下のように追記する<a href="#f2" name="fn2" title="設定ファイルのバックアップとっとけよ？">*2</a>。
```
[mysqld]
max_allowed_packet=16MB
```んで、 MySQL のサービスを再起動。 WebMatrix で再度 Web サイトをダウンロードしたら……成功━━━━(ﾟ∀ﾟ)━━━━!!
<div class="footnote">
<a href="#fn1" name="f1" class="footnote-number">*1</a><span class="footnote-delimiter">:</span><span class="footnote-text">wp_postmeta を消したらいろいろ吹っ飛びそうだ</span>
<a href="#fn2" name="f2" class="footnote-number">*2</a><span class="footnote-delimiter">:</span><span class="footnote-text">設定ファイルのバックアップとっとけよ？</span>
</div>

