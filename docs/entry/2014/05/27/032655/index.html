<!DOCTYPE html>
<html lang="ja">
    <head>
        <meta charset="UTF-8">
        <base href="https://daruyanagi.net/" />
        <link rel="canonical" href="https://daruyanagi.net/entry/2014/05/27/032655/" />

        <meta name="viewport" content="width=device-width,initial-scale=1">

        <title> 
            ただの日記： HTML5 Canvas に挑戦したった。 | だるやなぎ
        </title>

        

        
            
        

        
            <meta name="description" content="  （別に技術的な内容ではない。ただの日記だ。成果をまとめてるといつまでたってもブログが書けないし、それは自分の役割でもない気がする。ただ、近頃はこんなことをして遊んでるというだけの話だ。最近は時間がとれないので、こういう形が増えそうな気がする）太平洋戦争期の艦隊編成を年表みたいに表示できたらいいなと思って（こんなかんじ）、いろいろ頑張ってみた。最初は div を position: absolute で配置していく感じにしたのだけど、データが複雑になるにつれて破綻していくように思えたので、Canvas に図を書くことにした。Canvas に書いちゃうとテキストにリンクが貼れないのがちょっとアレだけど、それはそれで仕方ない。  とりあえず線を引くとこから始めて、半日後にはこんな感じに成長した。HTML5 Canvas は割りと低レベルな API っぽくて、線を一本引くだけでもダルい。みんなどうやっているんだろう。なんかラッパーを書くのかな？　ライブラリを使うのかな？まぁ、それはともかく。最初はグラフとデータが一体化していたのだけど（1941年12月8日は x px に、1945年8月15日は y px にマッピングしてそれを線で結ぶ、とかとか）、JavaScript に慣れるにしたがって少しずつ分けていった。そのデータも、最初は
var events = []; events.push(new Event(&#34;1941/12/08&#34;, &#34;開戦時編成&#34;)); events.push(new Event(&#34;1943/7/1&#34;, &#34;解体&#34;)); events.push(new Event(&#34;1944/8/15&#34;, &#34;再建&#34;)); events.push(new Event(&#34;1945/2/10&#34;, &#34;解体&#34;)); events.push(new Event(&#34;1945/8/15&#34;, &#34;終戦&#34;)); ```みたいな糞ダサいコードで用意していたのだけど（とりあえず動いてくれ！！）、最後には ```javascript var model = { &#34;fleetEvents&#34;: [ { &#34;date&#34;: &#34;1944/11/15&#34;, &#34;title&#34;: &#34;再編&#34; }, { &#34;date&#34;: &#34;1945/1/1&#34;, &#34;title&#34;: &#34;再編&#34; }, { &#34;date&#34;: &#34;1945/1/20&#34;, &#34;title&#34;: &#34;再編&#34; }, { &#34;date&#34;: &#34;1945/5/6&#34;, &#34;title&#34;: &#34;解体&#34; }, ], &#34;warEvents&#34;: [ { &#34;date&#34;: &#34;1941/12/08&#34;, &#34;title&#34;: &#34;開戦&#34; }, { &#34;date&#34;: &#34;1942/2/27&#34;, &#34;title&#34;: &#34;スラバヤ沖海戦&#34; }, { &#34;date&#34;: &#34;1942/6/5&#34;, &#34;title&#34;: &#34;ミッドウェー海戦&#34; }, { &#34;date&#34;: &#34;1944/10/25&#34;, &#34;title&#34;: &#34;サマール沖海戦&#34; }, { &#34;date&#34;: &#34;1945/8/15&#34;, &#34;title&#34;: &#34;終戦&#34; }, ], &#34;ships&#34;: [ { &#34;name&#34;: &#34;妙高&#34;, &#34;comm&#34;: &#34;1929/7/31&#34;, &#34;lost&#34;: &#34;1946/7/8&#34;, &#34;join&#34;: &#34;1941/12/08&#34;, &#34;left&#34;: &#34;1945/1/20&#34;, &#34;beforeJoin&#34;: &#34;開戦時在籍&#34;, &#34;afterLeft&#34;: &#34;第一南遣艦隊付属&#34;, &#34;damaged&#34;: [ { &#34;date&#34;: &#34;1944/12/13&#34;, &#34;title&#34;: &#34;大破&#34; } ] }, ```みたいな JSON データを読み込む感じにできた。これで、こんな JSON を返すサーバーを作れば動的にグラフが書けるハズ（今度はどうやってサーバーを書けばいいかわからん。Dapper で少し考えてみたけど、自分は結合とかよくわかってないから SQL だけでサクッと書けない。まぁ、C# で書けばいいのか）。  最初のスクリーンショットは第二駆逐艦のデータを使ったけど、次は同じプレゼンテーションコードに第五戦隊のデータをぶち込んでみた。テキストが被りまくってるのを除けば、だいたいうまくできてる（ってことは、ちゃんとデータとビューが分離できたってことなのかな？）。あとは measureText() でちゃんとテキストの大きさを図って、ずらして描画していけばいいはず。ちょっと JavaScript が楽しくなってきた。いまだに文法あんまり覚えてなくて、細かいところでハマって時間を浪費しているけれど、これから先 C# しかわかんないのもどうかと思うので頑張る。 " />
        

        
        
        <link rel="stylesheet" href="css/style.css">

    </head>
    <body class="body">

        <header class="global-header">
            <h1><a href="/" >だるやなぎ</a></h1>

<p>そうだ、だるだるしよう。</p>


        </header>

        <main>
            
    <article class="entry">

        <div class="entry__header">
            <div class="entry__header-taxonomies">
                
                
                    <div class="entry__header-taxonomies-category">
                        <span class="entry__header-taxonomies-category-title">
                            <a class="entry__header-taxonomies-category-title-link" href="https://daruyanagi.net/entry/">
                                Entries
                            </a>
                        </span>
                    </div>
                
                
            </div>

            <div class="entry__header-title">
                <a class="entry__header-title-link" href="https://daruyanagi.net/entry/2014/05/27/032655/" >
                    <h1 class="entry__header-title-link-text">ただの日記： HTML5 Canvas に挑戦したった。</h1>
                </a>
            </div>

            <div class="entry__header-date">
                <P>公開日：<time>2014/05/27</time>
                </P>
            </div>

        </div>
        <div class="entry__content">
            <p><figure>
    <img src="/images/20140527030620.png"/> 
</figure>
（別に技術的な内容ではない。ただの日記だ。成果をまとめてるといつまでたってもブログが書けないし、それは自分の役割でもない気がする。ただ、近頃はこんなことをして遊んでるというだけの話だ。最近は時間がとれないので、こういう形が増えそうな気がする）太平洋戦争期の艦隊編成を年表みたいに表示できたらいいなと思って（<a href="http://www.jyai.net/military/data-08/kuchikutai_00.htm">こんなかんじ</a>）、いろいろ頑張ってみた。最初は div を position: absolute で配置していく感じにしたのだけど、データが複雑になるにつれて破綻していくように思えたので、Canvas に図を書くことにした。Canvas に書いちゃうとテキストにリンクが貼れないのがちょっとアレだけど、それはそれで仕方ない。<figure>
    <img src="/images/20140527031021.png"/> 
</figure>
とりあえず線を引くとこから始めて、半日後にはこんな感じに成長した。HTML5 Canvas は割りと低レベルな API っぽくて、線を一本引くだけでもダルい。みんなどうやっているんだろう。なんかラッパーを書くのかな？　ライブラリを使うのかな？まぁ、それはともかく。最初はグラフとデータが一体化していたのだけど（1941年12月8日は x px に、1945年8月15日は y px にマッピングしてそれを線で結ぶ、とかとか）、JavaScript に慣れるにしたがって少しずつ分けていった。そのデータも、最初は</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">events</span> <span style="color:#f92672">=</span> [];
<span style="color:#a6e22e">events</span>.<span style="color:#a6e22e">push</span>(<span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Event</span>(<span style="color:#e6db74">&#34;1941/12/08&#34;</span>, <span style="color:#e6db74">&#34;開戦時編成&#34;</span>));
<span style="color:#a6e22e">events</span>.<span style="color:#a6e22e">push</span>(<span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Event</span>(<span style="color:#e6db74">&#34;1943/7/1&#34;</span>, <span style="color:#e6db74">&#34;解体&#34;</span>));
<span style="color:#a6e22e">events</span>.<span style="color:#a6e22e">push</span>(<span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Event</span>(<span style="color:#e6db74">&#34;1944/8/15&#34;</span>, <span style="color:#e6db74">&#34;再建&#34;</span>));
<span style="color:#a6e22e">events</span>.<span style="color:#a6e22e">push</span>(<span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Event</span>(<span style="color:#e6db74">&#34;1945/2/10&#34;</span>, <span style="color:#e6db74">&#34;解体&#34;</span>));
<span style="color:#a6e22e">events</span>.<span style="color:#a6e22e">push</span>(<span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Event</span>(<span style="color:#e6db74">&#34;1945/8/15&#34;</span>, <span style="color:#e6db74">&#34;終戦&#34;</span>));

<span style="color:#e6db74">```みたいな糞ダサいコードで用意していたのだけど（とりあえず動いてくれ！！）、最後には
</span><span style="color:#e6db74">```</span><span style="color:#a6e22e">javascript</span>
<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">model</span> <span style="color:#f92672">=</span> {
    <span style="color:#e6db74">&#34;fleetEvents&#34;</span><span style="color:#f92672">:</span> [
        { <span style="color:#e6db74">&#34;date&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;1944/11/15&#34;</span>, <span style="color:#e6db74">&#34;title&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;再編&#34;</span> },
        { <span style="color:#e6db74">&#34;date&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;1945/1/1&#34;</span>, <span style="color:#e6db74">&#34;title&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;再編&#34;</span> },
        { <span style="color:#e6db74">&#34;date&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;1945/1/20&#34;</span>, <span style="color:#e6db74">&#34;title&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;再編&#34;</span> },
        { <span style="color:#e6db74">&#34;date&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;1945/5/6&#34;</span>, <span style="color:#e6db74">&#34;title&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;解体&#34;</span> },
    ],
    <span style="color:#e6db74">&#34;warEvents&#34;</span><span style="color:#f92672">:</span> [
        { <span style="color:#e6db74">&#34;date&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;1941/12/08&#34;</span>, <span style="color:#e6db74">&#34;title&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;開戦&#34;</span> },
        { <span style="color:#e6db74">&#34;date&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;1942/2/27&#34;</span>, <span style="color:#e6db74">&#34;title&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;スラバヤ沖海戦&#34;</span> },
        { <span style="color:#e6db74">&#34;date&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;1942/6/5&#34;</span>, <span style="color:#e6db74">&#34;title&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;ミッドウェー海戦&#34;</span> },
        { <span style="color:#e6db74">&#34;date&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;1944/10/25&#34;</span>, <span style="color:#e6db74">&#34;title&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;サマール沖海戦&#34;</span> },
        { <span style="color:#e6db74">&#34;date&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;1945/8/15&#34;</span>, <span style="color:#e6db74">&#34;title&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;終戦&#34;</span> },
    ],
    <span style="color:#e6db74">&#34;ships&#34;</span><span style="color:#f92672">:</span> [
        {
            <span style="color:#e6db74">&#34;name&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;妙高&#34;</span>,
            <span style="color:#e6db74">&#34;comm&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;1929/7/31&#34;</span>,
            <span style="color:#e6db74">&#34;lost&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;1946/7/8&#34;</span>,
            <span style="color:#e6db74">&#34;join&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;1941/12/08&#34;</span>,
            <span style="color:#e6db74">&#34;left&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;1945/1/20&#34;</span>,
            <span style="color:#e6db74">&#34;beforeJoin&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;開戦時在籍&#34;</span>,
            <span style="color:#e6db74">&#34;afterLeft&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;第一南遣艦隊付属&#34;</span>,
            <span style="color:#e6db74">&#34;damaged&#34;</span><span style="color:#f92672">:</span> [
                { <span style="color:#e6db74">&#34;date&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;1944/12/13&#34;</span>, <span style="color:#e6db74">&#34;title&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;大破&#34;</span> }
            ]
        },

<span style="color:#e6db74">```みたいな JSON データを読み込む感じにできた。これで、こんな JSON を返すサーバーを作れば動的にグラフが書けるハズ（今度はどうやってサーバーを書けばいいかわからん。Dapper で少し考えてみたけど、自分は結合とかよくわかってないから SQL だけでサクッと書けない。まぁ、C# で書けばいいのか）。<figure>
    <img src="/images/20140527031652.png"/> 
</figure>
最初のスクリーンショットは第二駆逐艦のデータを使ったけど、次は同じプレゼンテーションコードに第五戦隊のデータをぶち込んでみた。テキストが被りまくってるのを除けば、だいたいうまくできてる（ってことは、ちゃんとデータとビューが分離できたってことなのかな？）。あとは measureText() でちゃんとテキストの大きさを図って、ずらして描画していけばいいはず。ちょっと JavaScript が楽しくなってきた。いまだに文法あんまり覚えてなくて、細かいところでハマって時間を浪費しているけれど、これから先 C# しかわかんないのもどうかと思うので頑張る。
</span><span style="color:#e6db74">
</span><span style="color:#e6db74">
</span></code></pre></div>
        </div>
        <div class="entry__footer">
            
            <div class="entry__footer-navigation">
                <span class="entry__footer-prev">
                     <a class="entry__page-navigation-link" href="https://daruyanagi.net/entry/2014/06/05/010551/">&laquo; 前の記事</a> 
                </span>
                <span class="entry__footer-lastmod">
                    
                    最終更新日：<time
                        datetime="2014-05-27T03:26:55JST">2014/05/27</time>
                    
                </span>
                <span class="entry__footer-next">
                     <a class="entry__page-navigation-link" href="https://daruyanagi.net/entry/2014/05/22/025753/">次の記事 &raquo; </a> 
                </span>
            </div>
        </div>

    </article>

        </main>

        <footer class="global-footer">
            <p>&copy; 2020 daruyanagi.</p>

        </footer>
    </body>
</html>