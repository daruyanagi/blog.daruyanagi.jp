<!DOCTYPE html>
<html><link rel="icon" href="https://via.placeholder.com/70x70">
<link rel="stylesheet" href="https://andybrewer.github.io/mvp/mvp.css">

<meta charset="utf-8">
<meta name="description" content="My description">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Highlight.js を NuGet パッケージにしてみました - だるろぐ - だるやなぎのブログ</title>

<style>
    nav {
        margin-bottom: 0;
    }

    body {
        font-family: "UD デジタル 教科書体 NP-R", Arial, Helvetica, sans-serif;
    }

    table {
        margin: 2em auto;
        border: none;
    }

    th, td, tr {
        text-align: right !important;
        padding: 1rem !important;
    }

    td {
        border-bottom: 1px solid gray;
    }
</style>


    
        
        <script async src="https://www.googletagmanager.com/gtag/js?id=UA-53152247-5"></script>
        <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-53152247-5');
        </script>
    
<body>
        <header><nav>
    <a href="/"><img alt="Logo" src="/logo.png" height="70"></a>
    
</nav>

<h1>だるろぐ - だるやなぎのブログ</h1>

<p></p>



<hr></header>

        <main>
<article>
    <h1>Highlight.js を NuGet パッケージにしてみました</h1>
    
    <p class="published">
        <time>
            公開日：
            2012/08/17
        </time>        
    </p>

    <p><a href="https://blog.daruyanagi.jp/entry/2012/08/16/155714">WebMatrix で Markdown を少しだけ拡張してみる - だるろぐ</a> と <a href="https://blog.daruyanagi.jp/entry/2012/08/16/182105">App_Code でサブフォルダーを利用する - だるろぐ</a> で扱った Highlight.js を NuGet パッケージにしてみました。最初は Highlight.js の NuGet パッケージは存在しないと思い込んでいたのですが、ただ検索のやり方が悪かったようで、「Highlight」というパッケージがあったり、似たような機能を実現できそうな「ColorCode」というパッケージもみつけたのですが、見なかったふりをします。 nuget.org はまだちょっと検索機能がイケてないような気がしますね（責任転嫁）。</p>
<div class="section">
    ### 準備
<div class="section">
    #### nuget.org のアカウントを作成
    <a href="http://nuget.org">NuGet Gallery | Home</a> でアカウントを作成してください。だいぶ前にやったのでやり方は忘れましたが、難しくはないはずです。
<figure>
    <img src="/images/20120817024658.png"/> 
</figure>

<p>カウントページで API キーが取得できるので、それをローカル環境に登録します。</p>
<pre><code>nuget.exe setApiKey ********-****-****-****-************
nuget.exe push MyPackage.1.0.nupkg
```NuGet.exe を入手（&lt;a href=&quot;http://nuget.codeplex.com/releases&quot;&gt;http://nuget.codeplex.com/releases&lt;/a&gt; NuGet.exe Command Line）して、1行目を実行すればOKです&lt;a href=&quot;#f-f45a0f4e&quot; name=&quot;fn-f45a0f4e&quot; title=&quot;初回起動時に実行ファイルのアップデートが行われます&quot;&gt;*1&lt;/a&gt;。

&lt;/div&gt;
&lt;div class=&quot;section&quot;&gt;
    #### パッケージに含めるファイルを用意
    今回パッケージに含めるファイルは以下のとおりです。
</code></pre><p>Highlight.js/</p>
<pre><code>Highlight.js.nuspec &amp;lt;-- あとで作りましょう！

content/
    （ ~/ 以下に展開されます）
    App_Code/
        Highlight/
            Highlight.cs
            Lisence Files
    Content/
        Highlight/
            Theme Skins
    Scripts/
        Highlight/
           hilight.pack.js
    web.config.transform &amp;lt;-- あとで説明します！

tools/
    （セットアップなどに利用するスクリプトなどを含めます）

lib/
    （必要な参照アセンブリを格納しておきます）
</code></pre>
<pre><code class="language-今回は" data-lang="今回は">```xml
&lt;!--?--&gt;xml version=&quot;1.0&quot;?&gt;
&lt;configuration&gt;&lt;/configuration&gt;
    .web&gt;
      debug=&quot;false&quot;&gt;
         &lt;codesubdirectories&gt;&lt;/codesubdirectories&gt;
           directoryName=&quot;Highlight&quot;/&gt;
         
      
   .web&gt;


```.transform という拡張子をつけて content フォルダーに置いておくだけで、勝手にインストール先の Web アプリの web.config とマージしてくれるみたいですね。あらまー、簡単！

&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;http://haacked.com/archive/2010/11/19/nuget-transformation.aspx&quot;&gt;NuGet Package Transformations | You’ve Been Haacked&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;section&quot;&gt;
    ### NuGet パッケージ（NuPack）の作成
    では、 NuGet のパッケージを作成します。手順は NuSpec ファイルに名前やバージョンなどのメタデータを記述して、 NuPack へ Pack（パッケージング）し、 nuget.org へ push （公開）するといった感じ。

&lt;div class=&quot;section&quot;&gt;
    #### NuSpec の作成
    

<figure>
    <img src="/images/20120817031210.png"/> 
</figure>


br/&gt;

</code></pre><p>nuget.exe spec</p>
<pre><code class="language-で雛形を出力します。内容はこんな感じになっているので、てけとーに編集します。" data-lang="で雛形を出力します。内容はこんな感じになっているので、てけとーに編集します。">```xml
&lt;!--?--&gt;xml version=&quot;1.0&quot;?&gt;
&lt;package&gt;&lt;/package&gt;
  &lt;metadata&gt;&lt;/metadata&gt;
    &lt;id&gt;&lt;/id&gt;Package
    &lt;version&gt;&lt;/version&gt;1.0.0
    &lt;authors&gt;&lt;/authors&gt;Hidetoshi Yanagi
    &lt;owners&gt;&lt;/owners&gt;Hidetoshi Yanagi
    &lt;licenseurl&gt;&lt;/licenseurl&gt;http://LICENSE_URL_HERE_OR_DELETE_THIS_LINE
    &lt;projecturl&gt;&lt;/projecturl&gt;http://PROJECT_URL_HERE_OR_DELETE_THIS_LINE
    &lt;iconurl&gt;&lt;/iconurl&gt;http://ICON_URL_HERE_OR_DELETE_THIS_LINE
    &lt;requirelicenseacceptance&gt;&lt;/requirelicenseacceptance&gt;false
    &lt;description&gt;&lt;/description&gt;Package description
    &lt;releasenotes&gt;&lt;/releasenotes&gt;Summary of changes made in this release of the package.
    &lt;copyright&gt;&lt;/copyright&gt;Copyright 2012
    &lt;tags&gt;&lt;/tags&gt;Tag1 Tag2
    &lt;dependencies&gt;&lt;/dependencies&gt;
      id=&quot;SampleDependency&quot; version=&quot;1.0&quot; /&gt;
    
  


```自分の場合はこんな感じになりました（v1.0.4 の場合）。
```xml
&lt;!--?--&gt;xml version=&quot;1.0&quot;?&gt;
&lt;package&gt;&lt;/package&gt;
  &lt;metadata&gt;&lt;/metadata&gt;
    &lt;id&gt;&lt;/id&gt;Highlight.js
    &lt;version&gt;&lt;/version&gt;1.0.4
    &lt;authors&gt;&lt;/authors&gt;Ivan Sagalaev
    &lt;owners&gt;&lt;/owners&gt;daruyanagi
    &lt;projecturl&gt;&lt;/projecturl&gt;http://softwaremaniacs.org/soft/highlight/en/
    &lt;requirelicenseacceptance&gt;&lt;/requirelicenseacceptance&gt;false
    &lt;description&gt;&lt;/description&gt;Syntax Highlighter written by JavaScript and CSS (and C# Helper)
    &lt;releasenotes&gt;&lt;/releasenotes&gt;Package for v7.1 release.
    &lt;copyright&gt;&lt;/copyright&gt;Copyright 2012 Hidetoshi Yanagi (@daruyanagi)
    &lt;tags&gt;&lt;/tags&gt;webmatrix javascript css syntax asp.net .net40
  


</code></pre></div>
<div class="section">
    #### NuPack の作成
<figure>
    <img src="/images/20120817031339.png"/> 
</figure>

<p>マンドを実行して、 NuPack を作成します。</p>
<pre><code>nuget.exe pack Highlight.js.nuspec
```すると、 nuget.exe のフォルダーに（パッケージ名）.（バージョン）.nupaack（今回なら Highlight.js.1.0.4.nupack）が作成されます。解凍ソフトでバラして中身を確認してみると面白いかも。

&lt;/div&gt;
&lt;div class=&quot;section&quot;&gt;
    #### NuPack の公開
    コマンドを実行して、 NuPack を公開します。
</code></pre><p>nuget.exe push Highlight.js.1.0.4.nupack</p>
<pre><code class="language-これで、" data-lang="これで、">
<figure>
    <img src="/images/20120817031425.png"/> 
</figure>


a href=&quot;https://nuget.org/packages/Highlight.js&quot;&gt;https://nuget.org/packages/Highlight.js&lt;/a&gt;もしよかったら使ってみてくださいね！

&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;section&quot;&gt;
    ### パッケージのテスト
    アップロードしたパッケージは、パッケージマネージャーでインストール・アンインストールしてちゃんと動くか確かめましょう&lt;a href=&quot;#f-a0ca43e7&quot; name=&quot;fn-a0ca43e7&quot; title=&quot;ごめんなさい、今までめんどくさくてだいたい動いていればOKかなって思ってました！&quot;&gt;*2&lt;/a&gt;。あと、「WebMatrix 2」で動くからといって「Visual Studio」でもそのまま動くかというとそうでもないみたいです。今回躓いたところを何点か補足しておきます。

&lt;div class=&quot;section&quot;&gt;
    #### パッケージが見つからない……
    

<figure>
    <img src="/images/20120817032039.png"/> 
</figure>


ップロードしたばかりのパッケージは「WebMatrix 2」の検索で引っかかりにくいです。

<figure>
    <img src="/images/20120817032125.png"/> 
</figure>


んなときは、フルネームでの検索を試みたり、パッケージのソースを変えてみるといいかもしれません。「Visual Studio」で利用する場合もそうですが、既定の検索結果が「ダウンロード数」順になっているみたいで、新参者はなかなか見つけにくい。「Visual Studio」の場合は、 CUI でインストールしてしまうのが手っ取り早いかもしれませんね。「WebMatrix 2」でも簡単に CUI で NuGet パッケージをインストールできるといいのですけど。

&lt;/div&gt;
&lt;div class=&quot;section&quot;&gt;
    #### .NET Framework のターゲット
    「WebMatrix 2」のプロジェクトを「Visual Studio 2012」で開いたのですが、そのままではヘルパー（自作の静的クラス）がうまく動きませんでした。

<figure>
    <img src="/images/20120817032540.png"/> 
</figure>


パラメーター初期化子を使うな」だの「System.Web.HtmlString なんてないよ！」だの言われるのでちょっと変だなと思っていたのですが、どうも .NET 2.0 でコンパイルしようとしているみたい。
```xml
&lt;!--?--&gt;xml version=&quot;1.0&quot;?&gt;
&lt;configuration&gt;&lt;/configuration&gt;
    .web&gt;
      targetFramework=&quot;4.0&quot; debug=&quot;false&quot;&gt;
         &lt;codesubdirectories&gt;&lt;/codesubdirectories&gt;
           directoryName=&quot;Highlight&quot;/&gt;
         
      
   .web&gt;


```web.config.transform を少し書き換えて、 .NET 4 を利用するようにしてみたら（targetFramework=&quot;4.0&quot;）ちゃんと動きました。ついでに、 NuSpec のタグに「.net 40」を追加して「.NET 4 用ですよ！」とわかるようにしておくと&lt;a href=&quot;#f-b9e55fda&quot; name=&quot;fn-b9e55fda&quot; title=&quot;周りのパッケージをみていると、そうしているのが多いように思います&quot;&gt;*3&lt;/a&gt;いいんじゃないでしょうか。

&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;section&quot;&gt;
    ### おわり！
    

<figure>
    <img src="/images/20120817034817.png"/> 
</figure>


れまでの3つのエントリー

&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://blog.daruyanagi.jp/entry/2012/08/16/043012&quot;&gt;WebMatrix で Markdown を使おう！ - だるろぐ&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://blog.daruyanagi.jp/entry/2012/08/16/155714&quot;&gt;WebMatrix で Markdown を少しだけ拡張してみる - だるろぐ&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://blog.daruyanagi.jp/entry/2012/08/16/182105&quot;&gt;App_Code でサブフォルダーを利用する - だるろぐ&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;で使ってきたサンプルプロジェクトでも、既存の Highlight.js 関連のコードをバッサリ消して NuGet パッケージに置き換えてみました。入れたり消したり、好き放題だ！

&lt;/div&gt;
&lt;div class=&quot;section&quot;&gt;
    ### おまけ
    

<figure>
    <img src="/images/20120817033216.png"/> 
</figure>


NuGet Package Explorer」ってなんだよ！　最初から知ってたらこっちを使ってたかもしれない（くっそくっそ！なんかしらんけどプラグインでカスタマったりできるらしいゼ？ 

&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;http://npe.codeplex.com/wikipage?title=How%20to%20write%20a%20plugin%20for%20NuGet%20Package%20Explorer&quot;&gt;CodePlex Archive&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;ダウンロードは nuget.exe と同じところから。

&lt;/div&gt;&lt;div class=&quot;footnote&quot;&gt;
&lt;a href=&quot;#fn-f45a0f4e&quot; name=&quot;f-f45a0f4e&quot; class=&quot;footnote-number&quot;&gt;*1&lt;/a&gt;&lt;span class=&quot;footnote-delimiter&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;footnote-text&quot;&gt;初回起動時に実行ファイルのアップデートが行われます&lt;/span&gt;
&lt;a href=&quot;#fn-a0ca43e7&quot; name=&quot;f-a0ca43e7&quot; class=&quot;footnote-number&quot;&gt;*2&lt;/a&gt;&lt;span class=&quot;footnote-delimiter&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;footnote-text&quot;&gt;ごめんなさい、今までめんどくさくてだいたい動いていればOKかなって思ってました！&lt;/span&gt;
&lt;a href=&quot;#fn-b9e55fda&quot; name=&quot;f-b9e55fda&quot; class=&quot;footnote-number&quot;&gt;*3&lt;/a&gt;&lt;span class=&quot;footnote-delimiter&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;footnote-text&quot;&gt;周りのパッケージをみていると、そうしているのが多いように思います&lt;/span&gt;
&lt;/div&gt;

</code></pre>
</article>

<section>
    <style>
        article p.published { text-align: right; }

        .spacer { margin: auto 1em;}
    </style>

    <p>
        
        <a href="https://blog.daruyanagi.jp/entry/2012/08/16/182105/">&laquo; Older</a>
        
        <span class="spacer">|</span>
        <a href="/">Home</a>
        <span class="spacer">|</span>
        <a href="#">Top</a>
        <span class="spacer">|</span>
        
            <a href="https://blog.daruyanagi.jp/entry/2012/08/17/050707/">Newer &raquo;</a>
        
    </p>    
    
</section>


        </main>
        
        <footer><hr>
<p>
    <a href="/about">daruyanagi</a> &copy; 2007-2020
</p></footer>
    </body>
</html>
