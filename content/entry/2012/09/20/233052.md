
+++
date = "2012-09-20 23:30:52 +0000 UTC"
draft = false
title = "WinRT/XAML のお勉強 ―― 4つの表示状態"
tags = ["WinRT"]

+++
Windows ストアアプリには4つの状態（VisualState）がある

<ul>
<li>**FullScreenLandscape**：全画面表示（横）</li>
<li>**FullScreenPortrait**：全画面表示（縦）</li>
<li>**Snapped**：端に寄せる（幅300px）</li>
<li>**Filled**：ほかのアプリを Snap した残りの領域に表示</li>
</ul>これを一つのデザインで対応しようとするととても難しい、という話が前回（<a href="https://blog.daruyanagi.jp/entry/2012/09/20/022735">WinRT/XAML のお勉強 ―― さまざまな利用シーンに対応する - だるろぐ</a>）だった。あれからいろいろ試したんだけれど、ひとつのデザインですべてをカバーしようとするより、4つの VisualState にそれぞれ個別にデザインを作って割り当てたほうがよさそうだ<a href="#f-d1bfc3d2" name="fn-d1bfc3d2" title="ただ、FullScreenLandscape と Filled はとてもよく似ているので、分ける必要はないかもしれない">*1</a>。じゃぁ、VisualState によってビューを切り替えるのってどうすればいいんだ？　ってのが今日の主題。
```xml
Style="{StaticResource LayoutRootStyle}">
    .RowDefinitions>
        Height="140"/>
        Height="*"/>
    .RowDefinitions>

    <!-- Back button and page title -->
    <grid></grid>
        （ヘッダー。内容省略）
    

    x:Name="FullScreenLandscapeGrid" 
          Grid.Row="1" Background="Blue" />
    x:Name="FullScreenPortraitGrid"
          Grid.Row="1" Background="Yellow" Visibility="Collapsed" />
    x:Name="SnappedGrid"
          Grid.Row="1" Background="Green" Visibility="Collapsed" />
    x:Name="FilledGrid"
          Grid.Row="1" Background="Red" Visibility="Collapsed" />

```こうやって VisualState に対応する Grid を用意する（名前でわかるよね！）。わかりやすくセンスの悪い背景色をそれぞれ割り当てておいた。Grid.Row="1" なのはヘッダー（Grid.Row[0]）の下に表示するためやね。 で、初期状態の FullScreenLandscape 以外は非表示（Visibility="Collapsed"）にしておく。あとは、最後のほうにある <visualstatemanager.visualstategroups> のところで、表示非表示を切り替えるだけ。</visualstatemanager.visualstategroups>
```xml
.VisualStateGroups>
    <!-- Visual states reflect the application's view state -->
    x:Name="ApplicationViewStates">
        x:Name="FullScreenLandscape">
             （初期表示なので別に何もしないでいい感じ）
        

        <!-- The entire page respects the narrower 100-pixel margin convention for portrait -->
        // 全画面（横向きになったら……）
        x:Name="FullScreenPortrait">
            <storyboard></storyboard>
                （関係のないところ省略）

                // FullScreenLandscapeGrid を非表示に
                
                    Storyboard.TargetName="FullScreenLandscapeGrid"
                    Storyboard.TargetProperty="Visibility">
                    
                        KeyTime="0" Value="Collapsed"/>
                

                // FullScreenPortraitGrid を表示に
                
                    Storyboard.TargetName="FullScreenPortraitGrid"
                    Storyboard.TargetProperty="Visibility">
                    
                        KeyTime="0" Value="Visible"/>
                
            
        

        // Filled になったら……
        x:Name="Filled">
        :
        : （以下略）

```結果はこんな感じ。

<div class="section">
    #### FullScreenLandscape
    

{{< figure src="/images/20120920231821.png"  >}}

br/>


</div>
<div class="section">
    #### FullScreenPortrait
    

{{< figure src="/images/20120920231828.png"  >}}

ullScreenLandscapeGrid.Visibility -> Collapsed<br/>
FullScreenPortraitGrid.Visibility -> Visible

</div>
<div class="section">
    #### Snapped
    

{{< figure src="/images/20120920231839.png"  >}}

ullScreenLandscapeGrid.Visibility -> Collapsed<br/>
SnappedGrid.Visibility -> Visible

</div>
<div class="section">
    #### Filled
    

{{< figure src="/images/20120920231848.png"  >}}

ullScreenLandscapeGrid.Visibility -> Collapsed<br/>
FilledGrid.Visibility -> Visibleあとはそれぞれ、解像度が変わる場合をよく考えながらデザインしていけばいいと思う。まぁ、なるべくテンプレ使うのがよさそうだけど、ちょっと試してみたところ、自分の目的には合わない気がしたのでやっぱこれで行こうと思う。

</div>
<div class="section">
    ### 余談
    ここまでやるのはそんなに難しくなかったけど、途中、シミュレーターの回転に異様に時間がかかり、いろんなエラーをはいてしまってちょっと躓いた。再起動でなおったけど……。最初は自分のソースが悪かったのかなぁと思ってあちこち直してたのだけど、結局新規にページを作ってもエラーが出るので、やっとシミュレーターがおかしいんだってわかった。まぁ、そんなこともあるよね。

</div><div class="footnote">
<a href="#fn-d1bfc3d2" name="f-d1bfc3d2" class="footnote-number">*1</a><span class="footnote-delimiter">:</span><span class="footnote-text">ただ、FullScreenLandscape と Filled はとてもよく似ているので、分ける必要はないかもしれない</span>
</div>

