
+++
date = "2012-09-24 00:54:47 +0000 UTC"
draft = false
title = "Windows ストアアプリでデータベース（SQLite 3）を使う"
tags = ["WinRT"]

+++
<img src="http://cdn-ak.f.st-hatena.com/images/fotolife/d/daruyanagi/20120924/20120924010032.gif" alt="f:id:daruyanagi:20120924010032g:plain" title="f:id:daruyanagi:20120924010032g:plain" class="hatena-fotolife"/>UPDATED HOWTO: SQLite with Windows 8 apps<br/>
<a href="http://timheuer.com/blog/archive/2012/08/07/updated-how-to-using-sqlite-from-windows-store-apps.aspx">http://timheuer.com/blog/archive/2012/08/07/updated-how-to-using-sqlite-from-windows-store-apps.aspx</a>@kaorun さんのはてブ経由で知った。前試したときはうまくいかなかったのだけど、今回はうまくできたっぽい。ポータブルなデータベースはやっぱりほしいよねぇ……。

<div class="section">
    ### 拡張機能「SQLite for Windows Runtime」をインストール
    <img src="http://cdn-ak.f.st-hatena.com/images/fotolife/d/daruyanagi/20120924/20120924003514.png" alt="f:id:daruyanagi:20120924003514p:plain" title="f:id:daruyanagi:20120924003514p:plain" class="hatena-fotolife"/>グローバルにインストールされるので、最初に一度やればよい。

</div>
<div class="section">
    ### NuGet パッケージ「sqlite-net」をインストール
    <img src="http://cdn-ak.f.st-hatena.com/images/fotolife/d/daruyanagi/20120924/20120924003710.png" alt="f:id:daruyanagi:20120924003710p:plain" title="f:id:daruyanagi:20120924003710p:plain" class="hatena-fotolife"/>これはプロジェクトごとにインストール。マネージドで扱うためのラッパーのようで、C# のソースコードで提供されている。Visual Basic で使いたい場合は一工夫必要みたい。

</div>
<div class="section">
    ### 参照の追加
    <img src="http://cdn-ak.f.st-hatena.com/images/fotolife/d/daruyanagi/20120924/20120924004222.png" alt="f:id:daruyanagi:20120924004222p:plain" title="f:id:daruyanagi:20120924004222p:plain" class="hatena-fotolife"/>「Microsoft Visual C++ Runtime Pakage」と「SQLite for Windows Runtime」を参照に追加。

</div>
<div class="section">
    ### ビルドターゲットを変更
    <img src="http://cdn-ak.f.st-hatena.com/images/fotolife/d/daruyanagi/20120924/20120924004424.png" alt="f:id:daruyanagi:20120924004424p:plain" title="f:id:daruyanagi:20120924004424p:plain" class="hatena-fotolife"/>Any CPU では動かないので、ほかの適当なものに変えておく。まぁ、とりあえず x86 とかでいいんじゃないかな。

</div>
<div class="section">
    ### 動かしてみる。
    空のテンプレートで、サンプルコードを試してみる。
```cs
namespace App1
{
    sealed partial class App : Application
    {
        public App()
        {
            this.InitializeComponent();
            this.Suspending += OnSuspending;

            LoadData();
        }

        ：
        ：

        public void LoadData()
        {
            var dbPath = Path.Combine(
                ApplicationData.Current.LocalFolder.Path,
                "db.sqlite");

            using (var db = new SQLite.SQLiteConnection(dbPath))
            {
                db.CreateTable&lt;Person>();

                db.RunInTransaction(() =>
                {
                    db.Insert(new Person() {
                        FirstName = "Tim", LastName = "Heuer"
                    });
                });
            }
        }
    }
}
  
 public class Person
 {
     [SQLite.AutoIncrement, SQLite.PrimaryKey]
     public int ID { get; set; }
     public string FirstName { get; set; }
     public string LastName { get; set; }
 }

```<img src="http://cdn-ak.f.st-hatena.com/images/fotolife/d/daruyanagi/20120924/20120924004845.png" alt="f:id:daruyanagi:20120924004845p:plain" title="f:id:daruyanagi:20120924004845p:plain" class="hatena-fotolife"/>LocalFolder に db.sqlite ができていた。結構簡単に扱えそうで、こりゃいいな。<img src="http://cdn-ak.f.st-hatena.com/images/fotolife/d/daruyanagi/20120924/20120924004850.png" alt="f:id:daruyanagi:20120924004850p:plain" title="f:id:daruyanagi:20120924004850p:plain" class="hatena-fotolife"/>データもちゃんと入っていたよ！SQLite の GUI ブラウザは <a href="http://www.forest.impress.co.jp/lib/offc/business/db/sqldbbrowser.html">窓の杜 - SQLite Database Browser</a> あたりが定番かな。

</div>

