
+++
date = "2011-11-13 11:11:08 +0000 UTC"
draft = false
title = "Page のものは Page に、App のものは App に"
tags = ["未分類"]

+++
たとえば、WebMatrix で作るWebサイトで、Webサイト全体で使える変数や、Webページでのみ参照できる変数というものはどうすれば実現できるのだろう？ ―― と思ったのだけど、簡単だった。<a href="http://blog.daruyanagi.net/archives/424">WebMatrix + Markdown …… リファクタリング。</a> のコードで言えばこんな感じ。
```
	@functions {
	    string ReadTextFile(string path)
	    {
	        path = string.Format("/Pages/{0}.txt", path);
	        path = Server.MapPath(path);

	        if (!File.Exists(path))
	        {
	            throw new HttpException(404, path + "is not found.");
	        }
	        
	        Page.CreatedAt = File.GetCreationTime(path);
	        Page.UpdatedAt = File.GetLastWriteTime(path);
	        // あとで@Page.CreatedAt 、＠Page.UpdatedAt で参照できる！

	        return File.ReadAllText(path);
	    }
	}
```<code>Page</code> は匿名型になっているので、自由にメンバー変数（？）を増やせる。Webサイト全体の場合は、<code>App</code> を使えばいいらしい。たとえば、<code>App.Title</code> にWebサイト名、<code>Page.Title</code>にページタイトルに突っ込んでおけば、__&lt;title>@Page.Title - @App.Title&lt;/title>__ という風にレイアウトファイルでタイトルをセットできる。僕は初めこの作法を知らなかったから、 <code>App_Code</code> にグローバル変数を保持するヘルパーを書いていた。見る人が見れば当たり前なんだろうけどね......orz


