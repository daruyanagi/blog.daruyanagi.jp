
+++
date = "2015-01-18 08:17:20 +0000 UTC"
draft = false
title = "WebMatrix：愛媛のニュースだけ読みたいので、Google ニュースから引っ張ってくる"
tags = ["WebMatrix","Google"]

+++


{{< figure src="/images/20150118081201.png"  >}}

元のニュースだけ読みたいので、それを Google ニュース引っ張ってくる BOT でも作ろうかと思って少し調べてみた。
```cs
# ~/App_Code/GoogleNews.cshtml

@using System.ServiceModel.Syndication
@using System.Xml

@helper Get(string query)
{
    var url = string.Format(
        "http://news.google.com/news?q={0}&amp;output=rss",
        query
    );

    using (var reader = XmlReader.Create(url))
    {
        var feed = SyndicationFeed.Load(reader);

        // @ObjectInfo.Print(feed);

        var data = feed.Items.Select(_ => new {
            Title = _.Title.Text,
            Summary = _.Summary.Text,
            PublishDate = _.PublishDate,
            Url = _.Links.First().Uri.ToString().Split(&#39;=&#39;).Last(),
        });

        // @ObjectInfo.Print(data);

        foreach (var d in data)
        {
            // <h2><a href="@d.Url">@d.Title</a></h2>
            &lt;p>@Html.Raw(d.Summary)&lt;/p>
            // <p>@d.PublishDate</p>
        }
    }
}

```パラメーターに output=rss をくっつけると RSS 形式でデータを取得できるので XmlReader と SyndicationFeed で読み込み・整形してやるとよさげ。残念なのでは地域ごとに絞れないこと<a href="#f-68c7e51c" name="fn-68c7e51c" title="本当はパラメーターに ned=jp を付けるとその国のニュースのみにデータを絞れるはずなのだけど、日本語版の Google ニュースでは利用できないようだ。">*1</a>。そのため「松山」で検索すると台湾の松山のニュースも引っかかるが……まぁ、これは仕方ないかな。JavaScript の API を利用すれば、ちゃんと制御できるようなので、JavaScript ができる人はそちらで書けばいいと思う。

<div class="section">
    ### 結果
    

{{< figure src="/images/20150118080353.png"  >}}

br/>

```cs
# ~/Default.cshtml

&lt;!DOCTYPE html>

&lt;html lang="en">
    &lt;head>
        &lt;meta charset="utf-8" />
        &lt;title>&lt;/title>
        &lt;style>
            * {
                font-family: Meiryo, sans-serif;
            }
        &lt;/style>
    &lt;/head>
    &lt;body>
        @GoogleNews.Get("愛媛 OR 松山 -秀樹 -ゴルフ")
    &lt;/body>
&lt;/html>

```天気予報機能も付けて（「☀時々☁、最高10度最低0度、西風後南西風海上後南西風稍強、波0.5米後1米」）、Twitter BOT にでもしようかな。

</div><div class="footnote">
<a href="#fn-68c7e51c" name="f-68c7e51c" class="footnote-number">*1</a><span class="footnote-delimiter">:</span><span class="footnote-text">本当はパラメーターに ned=jp を付けるとその国のニュースのみにデータを絞れるはずなのだけど、日本語版の Google ニュースでは利用できないようだ。</span>
</div>

