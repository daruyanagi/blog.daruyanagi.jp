<!DOCTYPE html>
<html lang="ja">
    <head>
        <meta charset="UTF-8">
        <base href="https://daruyanagi.net/" />
        <link rel="canonical" href="https://daruyanagi.net/entry/2019/02/04/195508/" />

        <meta name="viewport" content="width=device-width,initial-scale=1">

        <title> 
            2月4日：酢酸先生にそそのかされて、ローカルで痴漢した ～はてなブログのグローバルテキスト置換 | だるやなぎ
        </title>

        

        
            
        

        
            <meta name="description" content="はてなブログを daruyanagi.jp から blog.daruyanagi.jp へ移した結果、古い記事でリンク切れが多発していた。以前は daruyanagi.jp に ASP.NET アプリを置いてリダイレクトしていたが、それも消してしまったのでアクセス不能なページができてしまっている。ついでに http:// になっているリンクを https:// に書き換えたい――なんてことを考えながら、&gt;はてなブログ、置換機能ほしい……URL を一括で書き換えたりしたい（もうある？— だるやなぎ に天使が舞い降りた！ (@daruyanagi) February 4, 2019などと Twitter でつぶやいていたら、某焼き鳥の人が&gt;はてブロ自体には痴漢機能なかったからローカルで痴漢したで https://t.co/Ft6iqZGuid— さくさん (@ch3cooh) February 4, 2019 と教えてくれたので、鳥もすなる blogsync というものを だるやなぎ もしてみんとてするなり。酢酸先生は Mac でやったみたいだが、うちは Windows でやってみる
### Windows で blogsync を利用する   blogsync ははてなブログの記事をローカルに保存したり、ローカルで編集した記事をはてなブログに投稿できるコマンドラインツール。CUI に慣れてないとちょっとめんどいかなって感じるかもしれないけれど、そんなに難しくはない。とりあえず Windows 向けの手順を手短におおざっぱに―― #### 1. Chocolatey で Golang をインストールする blogsync は Go 言語（Golang）で開発されているので、まず Golang の環境を作る。Windows の場合、パッケージ管理ツール Chocolatey でインストールするのが一番楽だと思う。[Chocolatey - The package manager for Windows](https://chocolatey.org/)まだインストールしていない人は、Installation にあるワンライナーでサクッとインストールしよう。次に Cmd." />
        

        
        
        <link rel="stylesheet" href="css/style.css">

    </head>
    <body class="body">

        <header class="global-header">
            <h1><a href="/" >だるやなぎ</a></h1>

<p>そうだ、だるだるしよう。</p>


        </header>

        <main>
            
    <article class="entry">

        <div class="entry__header">
            <div class="entry__header-taxonomies">
                
                
                    <div class="entry__header-taxonomies-category">
                        <span class="entry__header-taxonomies-category-title">
                            <a class="entry__header-taxonomies-category-title-link" href="https://daruyanagi.net/entry/">
                                Entries
                            </a>
                        </span>
                    </div>
                
                
                    <div class="entry__header-taxonomies-tags">
                        <ul class="entry__header-taxonomies-tags-list" >
                            
                                
                                
                            
                                
                                
                            
                        </ul>
                    </div>
                
            </div>

            <div class="entry__header-title">
                <a class="entry__header-title-link" href="https://daruyanagi.net/entry/2019/02/04/195508/" >
                    <h1 class="entry__header-title-link-text">2月4日：酢酸先生にそそのかされて、ローカルで痴漢した ～はてなブログのグローバルテキスト置換</h1>
                </a>
            </div>

            <div class="entry__header-date">
                <P>公開日：<time>2019/02/04</time>
                </P>
            </div>

        </div>
        <div class="entry__content">
            <p>はてなブログを daruyanagi.jp から blog.daruyanagi.jp へ移した結果、古い記事でリンク切れが多発していた。以前は daruyanagi.jp に ASP.NET アプリを置いてリダイレクトしていたが、それも消してしまったのでアクセス不能なページができてしまっている。ついでに http:// になっているリンクを https:// に書き換えたい――なんてことを考えながら、&gt;はてなブログ、置換機能ほしい……URL を一括で書き換えたりしたい（もうある？— だるやなぎ に天使が舞い降りた！ (@daruyanagi) February 4, 2019<script async="" src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>などと Twitter でつぶやいていたら、某焼き鳥の人が&gt;はてブロ自体には痴漢機能なかったからローカルで痴漢したで  https://t.co/Ft6iqZGuid— さくさん (@ch3cooh) February 4, 2019<script async="" src="https://platform.twitter.com/widgets.js" charset="utf-8"></script> と教えてくれたので、鳥もすなる blogsync というものを だるやなぎ もしてみんとてするなり。酢酸先生は Mac でやったみたいだが、うちは Windows でやってみる</p>
<div class="section">
    ### Windows で blogsync を利用する
<div class="github-card" data-user="motemen" data-repo="blogsync" data-width="400" data-height="" data-theme="default"></div>
<script src="https://cdn.jsdelivr.net/github-cards/latest/widget.js"></script>
blogsync ははてなブログの記事をローカルに保存したり、ローカルで編集した記事をはてなブログに投稿できるコマンドラインツール。CUI に慣れてないとちょっとめんどいかなって感じるかもしれないけれど、そんなに難しくはない。とりあえず Windows 向けの手順を手短におおざっぱに――
<div class="section">
    #### 1. Chocolatey で Golang をインストールする
    blogsync は Go 言語（Golang）で開発されているので、まず Golang の環境を作る。Windows の場合、パッケージ管理ツール Chocolatey でインストールするのが一番楽だと思う。[Chocolatey - The package manager for Windows](https://chocolatey.org/)まだインストールしていない人は、<a href="https://chocolatey.org/install">Installation</a> にあるワンライナーでサクッとインストールしよう。次に Cmd.exe を管理者権限で起動し、以下のコマンドを入力して、Golang をインストールする。
```
choco install golang
```
</div>
<div class="section">
    #### 2. Go Get コマンドで blogsync を GitHub からとってくる＆初期設定
    <figure>
    <img src="/images/20190204192351.png"/> 
</figure>
ぶっちゃけ Go 言語はあまり知らんのだけど、Go Get という素敵ツールで blogsync のインストールができるらしい。
```
go get github.com/motemen/blogsync
```これで C:\Users\（ユーザー名）\go\bin に blogsync.exe がコピーされる。パスが通っているので、blogsync で呼び出せる（要 cmd の再起動、以後、C:\Users\（ユーザー名）は ~ と表記する）。次に、設定ファイル（~\.config\blogsync\config.yaml）を記述する。うちの場合はこんな感じ。
```
daruyanagi.hatenablog.com:
  username: daruyanagi
  password: ***
default:
  local_root: C:\Users\Hideto\Blogs
```API キーはブログの設定画面の［詳細設定］タブの下の方に書いてある。ひとつ注意しなければならないのは、**独自ドメインでブログを運用している場合**。うちは blog.daruyanagi.jp だが、この設定ファイルに記述すべきは独自ドメインを充てる前のドメイン daruyanagi.hatenablog.com となる（ここで躓いて、pull できたのに push できなかった）。元のドメインは、API キーの上に書いてあるルートエンドポイントを見ればわかる。<figure>
    <img src="/images/20190204193101.png"/> 
</figure>
<br/>
</div>
<div class="section">
    #### 3. blogsync ではてなブログをダウンロード（pull）する
    以下のコマンドですべての記事を取得。
```
blogsync pull daruyanagi.hatenablog.com
```C:\Users\Hideto\Blogs\daruyanagi.hatenablog.com 以下に記事が展開される。<figure>
    <img src="/images/20190204193536.png"/> 
</figure>
<br/>
</div>
<div class="section">
    #### 4. 好みのツールでテキスト置換を行う
    <figure>
    <img src="/images/20190204193702.png"/> 
</figure>
テキスト置換は好みのツールを使えばよい（コマンドが得意な人はコマンドでどうぞ）。うちは EmEditor がなぜかうまく動かなかったので、Devas というツールを利用した。[窓の杜](https://forest.watch.impress.co.jp/library/software/devas/)少々 UI は古臭いが、問題なく動く。
</div>
<div class="section">
    #### 5. blogsync ではてなブログをアップロード（push）する
    <figure>
    <img src="/images/20190204193840.png"/> 
</figure>
最後に、blogsync ではてなブログへ保存する。ほんとは変更したファイルだけ push すれば早いんだろうけど、めんどくさかったからザックリやった。
```
cd C:\Users\Hideto\Blogs\daruyanagi.hatenablog.com
for /r %f in (*.md) do blogsync push %f
```少し時間がかかるので（うちの場合 2,000 記事あったけど、10分弱ぐらいだったかなぁ？　忘れた）、お茶を飲みながら待つ。
</div>
</div>
<div class="section">
    ### 蛇足
<pre><code>&gt;
    ひとつ注意しなければならないのは、**独自ドメインでブログを運用している場合**。うちは blog.daruyanagi.jp だが、この設定ファイルに記述すべきは独自ドメインを充てる前のドメイン daruyanagi.hatenablog.com となる。ここを間違えると、pull できるが push できない。
</code></pre>
<p>blogsync の存在は以前から知ってたけど、ここで躓いて「Windows には対応してないのかな？」と思っていた。カッとなって WSL でも blogsync の環境を作ったが（当初はこっちで記事を書くつもりだった）、問題にぶち当たったので、「どうも設定を書き間違えてるんじゃないか」と気付けた。結局、Windows 10 でも WSL/Ubuntu でも問題なく動作したので、好みの方でやればいいと思う。<figure>
    <img src="/images/20190204195039.png"/> 
</figure>
ちなみに、WSL でのセットアップは Choco を入れずに済む分、Windows 環境より簡単。find、grep、sed が使えるなら、WSL の方が楽かもね（適当に sudo してね）。</p>
<pre><code>apt-get update
apt-get install golang
go get github.com/motemen/blogsync
mkdir -p ~/.config/blogsync/
vim ~/.config/blogsync/config.yaml
~/go/bin/blogsync pull blog.daruyanagi.jp
</code></pre></div>
<div class="section">
    ### 蛇足2
    「はてなブログ一括置換ツール」という便利なサービスがあるっぽいので（知らなかった！）、こっちを使うのもありか。ただし、API キーを見ず知らずの人に預けなきゃいけない。[はてなブログ一括置換ツール](https://spiderwebs.tokyo/customize-tool/replace-login.php)<br/>
</div>
<div class="section">
    ### 追伸（2019/02/05）
    >訴訟 pic.twitter.com/E1XzqNcu70— しばやん (@shibayan) February 4, 2019<script async="" src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>クソわろたｗ
</div>

        </div>
        <div class="entry__footer">
            
            <div class="entry__footer-navigation">
                <span class="entry__footer-prev">
                     <a class="entry__page-navigation-link" href="https://daruyanagi.net/entry/2019/02/17/190246/">&laquo; 前の記事</a> 
                </span>
                <span class="entry__footer-lastmod">
                    
                    最終更新日：<time
                        datetime="2019-02-04T19:55:08JST">2019/02/04</time>
                    
                </span>
                <span class="entry__footer-next">
                     <a class="entry__page-navigation-link" href="https://daruyanagi.net/entry/2019/02/04/040627/">次の記事 &raquo; </a> 
                </span>
            </div>
        </div>

    </article>

        </main>

        <footer class="global-footer">
            <p>&copy; 2020 daruyanagi.</p>

        </footer>
    </body>
</html>