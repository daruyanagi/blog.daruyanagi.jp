
+++
date = "2012-01-21 20:31:20 +0000 UTC"
draft = false
title = " URLとして使えない文字が含まれているのを検出する"
tags = ["C#"]

+++
[Url]という属性を作成。 \"&#39;|*`^>&lt;)(}{][#%;/?:@&amp;=+$,. が含まれていたら IsValid() => false を返す。

    ```C
[AttributeUsage(AttributeTargets.Property, AllowMultiple = false)]
public sealed class UrlAttribute
    : ValidationAttribute, IClientValidatable
{
    public UrlAttribute()
    {
        ErrorMessage = "URLに利用できない文字が含まれています。";
    }
    
    private readonly char[] INVALID_CHARS =
        "\\\"&#39;|*`^>&lt;)(}{][#%;/?:@&amp;=+$,.".ToCharArray();
    
    public IEnumerable&lt;ModelClientValidationRule>
        GetClientValidationRules(
        ModelMetadata metadata, ControllerContext context)
    {
        var rule = new ModelClientValidationRule
        {
            ValidationType = "url",
            ErrorMessage = FormatErrorMessage(
               metadata.GetDisplayName()),
        };
    
        yield return rule;
    }
    
    public override bool IsValid(object value)
    {
        if (value == null || value.GetType() != typeof(string))
        {
            return true;
        }
    
        return !(INVALID_CHARS.Any(
            c => ((string)value).Contains(c)));
    }
}
```
モデル側で適当なメンバーに[Url]を付与する。

    ```C#
public class Post
{
    [Required]
    public int PostId { get; set; }

    [Required]
    [Url]
    [DisplayName("タイトル")]
    public string Title { get; set; }
    :
    :
```
<img src="http://cdn-ak.f.st-hatena.com/images/fotolife/d/daruyanagi/20120121/20120121203055.png" alt="f:id:daruyanagi:20120121203055p:plain" title="f:id:daruyanagi:20120121203055p:plain" class="hatena-fotolife"/>


