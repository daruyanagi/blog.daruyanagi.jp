
+++
date = "2012-01-25 00:07:39 +0000 UTC"
draft = false
title = " Embedded Tweets を使ってWebページにツイートを埋め込む"
tags = ["C#"]

+++
最近のTwitterでは、ツイートの埋め込み用のタグが、パーマリンクから簡単に取得できるらしい。<img src="http://cdn-ak.f.st-hatena.com/images/fotolife/d/daruyanagi/20120125/20120125002147.png" alt="f:id:daruyanagi:20120125002147p:plain" title="f:id:daruyanagi:20120125002147p:plain" class="hatena-fotolife"/>これをコードからもやってみたくて、 <a href="https://dev.twitter.com/docs/embedded-tweets">Embedded Tweets | Twitter Developers</a> を参考にちょっとやってみた。

    ```?
var tweet_url = url;
// 例: https://twitter.com/#!/daruyanagi/statuses/57438593853034497

var tweet_id = new Regex(@"status/(?&lt;id>\d+)")
    .Match(tweet_url).Groups["id"].ToString();

var tweet = new System.Net.WebClient()
    .DownloadString(string.Format(
        "https://api.twitter.com/1/statuses/oembed.json?id={0}",
        tweet_id));

return Codeplex.Data.DynamicJson.Parse(tweet).html;
```
<img src="http://cdn-ak.f.st-hatena.com/images/fotolife/d/daruyanagi/20120125/20120125000256.png" alt="f:id:daruyanagi:20120125000256p:plain" title="f:id:daruyanagi:20120125000256p:plain" class="hatena-fotolife"/>APIを叩くとJSONデータが返ってくるので、そこから"html"の値を取得。このあたりの処理は DynamicJson (NuGetでインストールできる)で楽をさせてもらいました。<img src="http://cdn-ak.f.st-hatena.com/images/fotolife/d/daruyanagi/20120125/20120125000424.png" alt="f:id:daruyanagi:20120125000424p:plain" title="f:id:daruyanagi:20120125000424p:plain" class="hatena-fotolife"/><a href="https://platform.twitter.com/widgets.js">https://platform.twitter.com/widgets.js</a> を読み込んでおけば、勝手に整形もしてくれるみたい。ちょっと日付周りの表記がおかしいけれど、まぁ、これぐらいはしょうがないかな。


