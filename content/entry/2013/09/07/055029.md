
+++
date = "2013-09-07 05:50:29 +0000 UTC"
draft = false
title = "WebMatrix 3"
tags = ["WebMatrix","ASP.net Web Pages","Twitter"]

+++


{{< figure src="/images/20130907053932.png"  >}}

またま <a href="https://tweetinvi.codeplex.com/">Tweetinvi a friendly Twitter C# API - Home</a> というのをみかけたのだけど、割と便利だった。
```cs
@{
    var token = new TwitterToken.Token(
        "*****************Pj5ecAhlw3SqBPU5qHtBUSiTQDcgmUzBU", 
        "*****************RZSPVglcM0TfE7mPCFzm334rw", 
        "*****************cSizQ", 
        "*****************zws06agyxRXImPk9sfETNQeg");

    if (IsPost)
    {
        var tweet = new Tweetinvi.Tweet("てすてす");
        tweet.Publish(token);
    }
}

&lt;!DOCTYPE html>

&lt;html lang="ja">
    &lt;head>
&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
        &lt;meta charset="utf-8" />
        &lt;title>マイ サイトのタイトル&lt;/title>
        &lt;link href="~/favicon.ico" rel="shortcut icon" type="image/x-icon" />
    &lt;/head>
    &lt;body>
        &lt;ul>
        @foreach (var tweet in new Tweetinvi.User("daruyanagi", token).GetUserTimeline())
        {
            &lt;li>@tweet.Text&lt;/li>
        }
        &lt;/ul>

        &lt;form action="" method="post">
            &lt;input type="submit" />
        &lt;/form>
    &lt;/body>
&lt;/html>

```

{{< figure src="/images/20130907054421.png"  >}}

ET でタイムラインを表示（なんかゴミ（\）が入ってるけど、バグかな。あとで報告しよう）。POST でツイート。<div class="twitter-detail twitter-detail-left"><div class="twitter-detail-user"><a class="twitter-user-screen-name" href="http://twitter.com/daruyanagi"><img src="http://a0.twimg.com/profile_images/378800000393919137/3f8f24154e59a5b674e1e6893a34a7e5_normal.png" alt="daruyanagi" height="48" width="48"/></a></div><div class="twitter-detail-tweet">      てすてす<a href="http://twitter.com/daruyanagi/status/376083703023157249" class="twitter-detail-info-permalink"><span class="twitter-detail-info-date">2013-09-07</span> <span class="twitter-detail-info-time">05:45:16</span></a> <span class="twitter-detail-info-source">via <a href="http://127.0.0.1:5551/" rel="nofollow">建造メモ</a></span></div></div>Twitter 系のライブラリってピンキリだけど、これは UserStreams も扱えるようで、悪くない感じかな。デスクトップアプリにも組み込める、というか、PIN の認証はあるけど Web アプリの認証は今のところ未実装みたいなので、どっちかっていうと今のところデスクトップアプリ向けって感じ。

<div class="section">
    ### 不具合、直していただきました
    
<ul>
<li><a href="https://tweetinvi.codeplex.com/SourceControl/changeset/31484">Tweetinvi a friendly Twitter C# API - Source Code</a></li>
</ul>レスポンス、ちょっぱや！　対応の早いところも推せますね、このライブラリ。ちなみに String.CleanString() という処理が入っているのが原因でした。

    >
        If you want to store the Text in a database you can still use the extension method : 
String.CleanString() before the INSERT / UPDATE call. 

    
String.CleanString() は String の拡張メソッドで、サニタイズだかエスケープだかをするのかな？　MySQL はぜんぜん知らない。
```cs
/// &lt;summary>
/// Clean a string so that it can be used in a URL and
/// sent to Twitter
/// &lt;/summary>
/// &lt;param name="s">String to clean&lt;/param>
/// &lt;returns>Cleaned string&lt;/returns>
public static string CleanString(this string s)
{
    return s != null ? (s.HTMLDecode().MySQLClean().ReplaceNonPrintableCharacters(&#39;\\&#39;)) : null;
}

```
</div>

