
+++
date = "2012-08-28 19:11:29 +0000 UTC"
draft = false
title = "WebMatrix でユーザー認証機能（4） ―― ログインとログオフ"
tags = ["ASP.net Web Pages","WebMatrix"]

+++
<a href="https://blog.daruyanagi.jp/entry/2012/08/25/003421">WebMatrix でユーザー認証機能（3） ―― なにはともあれユーザー登録しないと始まらん - だるろぐ</a> で無事ユーザー登録ができ、ログインされた。という訳で今回はログアウトを実装しなければならない。
```cs
# Logout.cshtml

@{
    WebSecurity.Logout();

    var returnUrl = Request.QueryString["ReturnUrl"];
    Response.Redirect(returnUrl.IsEmpty() ? "~/" : returnUrl);
}

```おわり！　ほんとにこれだけだよ……。一応、 Logout?ReturnUrl=~/Account/Login なんかで ~/Account/Login へリダイレクトされるようにしてみたけど。ちなみに、ログイン処理は少し長くなった。
```cs
# Login.cshtml

@{
    var name = "";
    var password = "";
    var rememberMe = true;

    Validation.RequireField(
        "name", "You must specify an name address.");
    Validation.RequireField(
        "password", "You must specify a password.");

    if (IsPost)
    {
        name = Request.Form["name"];
        password = Request.Form["password"];
        rememberMe = Request.Form["rememberMe"].AsBool();

        if (Validation.IsValid())
        {
            if (WebSecurity.Login(name, password, rememberMe))
            {
                var returnUrl = Request.QueryString["ReturnUrl"];
                Response.Redirect(
                    returnUrl.IsEmpty() ? "~/" : returnUrl);
            }
            else
            {
                ModelState.AddFormError(
                    "The user name or password is incorrect.");
            }
        }
    }
}

&lt;section id="login">
    &lt;form method="post">
        @Html.ValidationSummary("Log in was unsuccessful." + 
            "Please correct the errors and try again.",
            excludeFieldErrors: true, htmlAttributes: null)

        &lt;fieldset>
            &lt;legend>Log in to Your Account&lt;/legend>
            @this.RenderTextWithValidation("name")
            @this.RenderPasswordWithValidation("password")
            @this.RenderCheckBoxWithValidation("rememberMe")
            &lt;input type="submit" value="Log in" />
        &lt;/fieldset>
    &lt;/form>
    &lt;p>
        &lt;a href="~/Account/Register">Don&#39;t have a Account?&lt;/a>
    &lt;/p>
&lt;/section>

```

{{< figure src="/images/20120828191313.png"  >}}

a href="https://blog.daruyanagi.jp/entry/2012/08/28/081228">寄り道: string クラスの拡張 - だるろぐ</a> で作ったコードのお陰で、 RenderTextWithValidation() などがシンプルになっている以外はほとんどユーザー登録の処理と変わらない感じ。次は OAuth でログインできるようになればいいな。

<div class="section">
    ### ちなみに
    string.AsBool や string.IsEmpty は ASP.NET Web Pages に含まれているのかな？ このあたりの関数については、 <a href="http://msdn.microsoft.com/ja-jp/asp.net/hh180209.aspx">ASP.NET | The ASP.NET Site</a> でコンパクトに纏められているので、一度目を通しておくとわしみたいに車輪の再発明をせずに済むぞ！

</div>

