<!DOCTYPE html>
<html><link rel="icon" href="https://via.placeholder.com/70x70">
<link rel="stylesheet" href="https://andybrewer.github.io/mvp/mvp.css">

<meta charset="utf-8">
<meta name="description" content="My description">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>空のアプリケーションから ASP.NET Core Razor Page を始める - だるろぐ - だるやなぎのブログ</title>

<style>
    nav {
        margin-bottom: 0;
    }

    body {
        font-family: "UD デジタル 教科書体 NP-R", Arial, Helvetica, sans-serif;
    }

    table {
        margin: 2em auto;
        border: none;
    }

    th, td, tr {
        text-align: right !important;
        padding: 1rem !important;
    }

    td {
        border-bottom: 1px solid gray;
    }
</style>


    
        
        <script async src="https://www.googletagmanager.com/gtag/js?id=UA-53152247-5"></script>
        <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-53152247-5');
        </script>
    
<body>
        <header><nav>
    <a href="/"><img alt="Logo" src="/logo.png" height="70"></a>
    
</nav>

<h1>だるろぐ - だるやなぎのブログ</h1>

<p></p>



<hr></header>

        <main>
<article>
    <h1>空のアプリケーションから ASP.NET Core Razor Page を始める</h1>
    
    <p class="published">
        <time>
            公開日：
            2017/08/15
        </time>        
    </p>

    <figure>
    <img src="/images/20170815033116.png"/> 
</figure>

<p>回は ASP.NET Core Razor Page をチラ見してみましたが、ひな型（サンプル）プロジェクトが割とゴツい。これでは全体的な見通しが悪くて理解が進まないし、また_「Razor Pages はカンタン！」_というのも伝わりにくいと思いました。<a href="http://blog.daruyanagi.jp/entry/2017/08/15/032010">Visual Studio 2017.3 が出たっぽいので、ASP.NET Core Razor Pages をチラ見してみる - だるろぐ</a>そこで、今回は Visual Studio 2017.3 を利用して“空”のアプリケーションから Razor Pages で Hello! World するまでをステップバイステップでやっていこうかなと思います。</p>
<div class="section">
    ### 空のアプリケーションを作成する
<figure>
    <img src="/images/20170815033122.png"/> 
</figure>

<p>ず、［新しいプロジェクト］コマンドで .NET Core、ASP.NET Core Web アプリケーションを作成。フレームワークを .NET Core へ、.NET のバージョンを 2.0.0 に切り替えて、“空”のアプリケーションを作成します。</p>
<figure>
    <img src="/images/20170815033129.png"/> 
</figure>

<p>のアプリケーションには、ソリューションファイルなどを除くと</p>
<ul>
<li>Program.cs</li>
<li>Startup.cs</li>
<li>静的ファイルを置く wwwroot フォルダー</li>
</ul>の3つしかありません。シンプルだね！　コードも最低限で、
<figure>
    <img src="/images/20170815033136.png"/> 
</figure>

<p>F5］キーで実行すると“Hello! World”が表示されるだけです。まずはここから始めましょう。</p>
</div>
<div class="section">
    ### Program.cs と Startup.cs
    Program.cs は、アプリケーションを実行する際、最初に処理されます（エントリポイントってやつだな）。
```cs
using Microsoft.AspNetCore;
using Microsoft.AspNetCore.Hosting;
<p>namespace WebApplication3
{
public class Program
{
public static void Main(string[] args)
{
BuildWebHost(args).Run();
}</p>
<pre><code>    public static IWebHost BuildWebHost(string[] args) =&gt;
        WebHost.CreateDefaultBuilder(args)
            .UseStartup&amp;lt;Startup&gt;()
            .Build();
}
</code></pre>
<p>}</p>
<pre><code class="language-WebHost" data-lang="WebHost">```cs
using Microsoft.AspNetCore.Builder;
using Microsoft.AspNetCore.Hosting;
using Microsoft.AspNetCore.Http;
using Microsoft.Extensions.DependencyInjection;

namespace WebApplication3
{
    public class Startup
    {
        public void ConfigureServices(IServiceCollection services)
        {

        }

        public void Configure(IApplicationBuilder app, IHostingEnvironment env)
        {
            if (env.IsDevelopment())
            {
                app.UseDeveloperExceptionPage();
            }

            app.Run(async (context) =&gt;
            {
                await context.Response.WriteAsync(&quot;Hello World!&quot;);
            });
        }
    }
}

```リクエストがあったらレスポンスに“Hello! World”と書いて送るだけのようです。

&lt;/div&gt;
&lt;div class=&quot;section&quot;&gt;
    ### Razor Pages を使う
    Razor Pages は MVC に含まれています。なので、まず Startup.cs で MVC を有効にします。
```cs
namespace WebApplication3
{
    public class Startup
    {
        // This method gets called by the runtime. Use this method to add services to the container.
        // For more information on how to configure your application, visit https://go.microsoft.com/fwlink/?LinkID=398940
        public void ConfigureServices(IServiceCollection services)
        {
            services.AddMvc();
        }

        // This method gets called by the runtime. Use this method to configure the HTTP request pipeline.
        public void Configure(IApplicationBuilder app, IHostingEnvironment env)
        {
            if (env.IsDevelopment())
            {
                app.UseDeveloperExceptionPage();
            }

            // もう要らないのでコメントオフ
            // app.Run(async (context) =&gt;
            // {
            //     await context.Response.WriteAsync(&quot;Hello World!&quot;);
            // });

            app.UseMvc();
        }
    }
}

```これだけだと実行して何も表示されないので、ビューも追加しましょう。

<figure>
    <img src="/images/20170815041428.png"/> 
</figure>


ず、アプリケーションルートに Pages フォルダーを作成。Razor Pages の *.cshtml はここに保存します（設定で変更可能できるらしいけど）。

<figure>
    <img src="/images/20170815035213.png"/> 
</figure>


に Pages フォルダーのコンテキストメニュー から“MVC ビュー”を追加。これは要するに *.cshtml ファイルです。“Razor ページ”でも *.cshtml を追加できますが、ビューモデルの *.cs ファイルもくっついてくるので（これはこれで便利だけど、まだお子さまには早い！）、今回は“MVC ビュー”にしておきました。ちなみに、名前は Index.cshtml にしておきます。&lt;code&gt;/&lt;/code&gt; にアクセスすると、&lt;code&gt;/Pages/Index.cshtml&lt;/code&gt; が自動で表示される仕組みになっていますので（ルーティングの規則については、また機会を改めましょう）。内容はこんな感じ。ごちゃごちゃ書いてあるのは、［Ctrl］＋［A］して［Delete］しちゃって下さい。
```html
@page

&amp;lt;p&gt;Hello! World&amp;lt;/p&gt;

```［F5］キーで実行すると、こんな感じになるはずです。

<figure>
    <img src="/images/20170815035710.png"/> 
</figure>


きた＼(＾o＾)／でも、これだけでは Razor Pages を使っている意味がないので、変数を使ってみます（文法に関しては説明しません。ググってね！　めっちゃ簡単だよ）。
```html
@page

@{ 
    var message = &quot;Hello! World&quot;;
}

&amp;lt;p&gt;@message by Razor Pages&amp;lt;/p&gt;

```ページの先頭に_「Razor Pages だよ！」_ってことを知らせるディレクティブ @page を追加している以外は ASP.NET Web Pages（Razor）とまったく変わりません。保存してブラウザーをリロードするとこんな感じになるでしょう。

<figure>
    <img src="/images/20170815040013.png"/> 
</figure>


んまり面白くないですかね？　こうしてみますか。
```html
@page &quot;{message?}&quot;

@{ 
    var message = Request.Query[&quot;message&quot;];
}

&amp;lt;p&gt;@message by Razor Pages&amp;lt;/p&gt;

</code></pre><figure>
    <img src="/images/20170815040646.png"/> 
</figure>

<p>pages のあとに routing constraint を書けるのは新しいかもしれません。この例では正直意味がないのですが（消してもそのまま動くしな）、モデルで <em>void OnGet(string message)</em> などと受け取れるので覚えておくといい感じ。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">@page &#34;{message?}&#34;
@using Microsoft.AspNetCore.Mvc.RazorPages
@model IndexModel

@functions 
{ 
    public class IndexModel : PageModel
    {
        public string Message { get; private set; }

        public void OnGet(string message)
        {
            Message = string.IsNullOrEmpty(message)
                ? &#34;Hello! World&#34;
                : message;
        }
    }
}

&amp;lt;p&gt;@Model.Message by Razor Pages&amp;lt;/p&gt;

```もっと複雑な型データを受け取るときに役立つでしょう。ちなみに @functions の部分は *.cs ファイルに分離することもできます（NEW!）。
```html
@page &#34;{message?}&#34;
@model IndexModel

&amp;lt;p&gt;@Model.Message by Razor Pages&amp;lt;/p&gt;

```ちょうど WPF や WinForm のビュー（デザイナー）＋コードビハインドみたいな感じで、スッキリしていいですね（こういうことがしたい場合は、最初から“MVC ビュー”ではなく“Razor ビュー”を追加するといいです）。もっと詳しいことが知りたい場合は、チュートリアルページを参照してください。自分もあとでゆっくり読んでみようと思います。[Introduction to Razor Pages in ASP.NET Core](https://docs.microsoft.com/en-us/aspnet/core/mvc/razor-pages/)[Getting started with Razor Pages in ASP.NET Core](https://docs.microsoft.com/en-us/aspnet/core/tutorials/razor-pages/razor-pages-start)&lt;<span style="color:#f92672">br</span>/&gt;


&lt;/<span style="color:#f92672">div</span>&gt;
&lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;section&#34;</span>&gt;
    ### おまけ
    

<figure>
    <img src="/images/20170815041046.png"/> 
</figure>


のアプリケーションには 2 つの NuGet パッケージが含まれています。

&lt;<span style="color:#f92672">ul</span>&gt;
&lt;<span style="color:#f92672">li</span>&gt;Microsoft.AspNetCore.All&lt;/<span style="color:#f92672">li</span>&gt;
&lt;<span style="color:#f92672">li</span>&gt;Microsoft.NETCore.App&lt;/<span style="color:#f92672">li</span>&gt;
&lt;/<span style="color:#f92672">ul</span>&gt;初期状態ではどっちもプレビュー版で、前者のみ v2.0.0 正式版へのアップデートが提供されています。

<figure>
    <img src="/images/20170815041223.png"/> 
</figure>


も、片っぽだけアップデートすると実行時にコケるみたい。もうちょっと待ちますかね。

&lt;/<span style="color:#f92672">div</span>&gt;

</code></pre></div>
</article>

<section>
    <style>
        article p.published { text-align: right; }

        .spacer { margin: auto 1em;}
    </style>

    <p>
        
        <a href="https://blog.daruyanagi.jp/entry/2017/08/15/032010/">&laquo; Older</a>
        
        <span class="spacer">|</span>
        <a href="/">Home</a>
        <span class="spacer">|</span>
        <a href="#">Top</a>
        <span class="spacer">|</span>
        
            <a href="https://blog.daruyanagi.jp/entry/2017/08/15/121303/">Newer &raquo;</a>
        
    </p>    
    
</section>


        </main>
        
        <footer><hr>
<p>
    <a href="/about">daruyanagi</a> &copy; 2007-2020
</p></footer>
    </body>
</html>
