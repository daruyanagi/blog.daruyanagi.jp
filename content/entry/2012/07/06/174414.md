
+++
date = "2012-07-06 17:44:14 +0000 UTC"
draft = false
title = "WebMatrix のルーティング"
tags = ["WebMatrix","ASP.net Web Pages"]

+++
<div class="section">
    ### 保護されたファイル・フォルダ
    一部の特殊な意味を持つファイルやフォルダには、Webブラウザーからアクセスできない。逆に言えば、外部からアクセスされては困るファイルやフォルダは、特定のフォルダに格納したり、ファイル名を規約に従ってつければいい。

<div class="section">
    #### bin にはアクセスできない
    <img src="http://cdn-ak.f.st-hatena.com/images/fotolife/d/daruyanagi/20120706/20120706163939.png" alt="f:id:daruyanagi:20120706163939p:plain" title="f:id:daruyanagi:20120706163939p:plain" class="hatena-fotolife"/>bin にはコンパイルされたアセンブリが格納されているので、当然アクセスが禁止されている。

</div>
<div class="section">
    #### App_Data / App_Code にはアクセスできない
    <img src="http://cdn-ak.f.st-hatena.com/images/fotolife/d/daruyanagi/20120706/20120706164032.png" alt="f:id:daruyanagi:20120706164032p:plain" title="f:id:daruyanagi:20120706164032p:plain" class="hatena-fotolife"/>

<ul>
<li>**App_Data**：アプリケーションのデータを格納（データベースなど）</li>
<li>**App_Code**：アプリケーションのソースコードを格納（ヘルパーなど）</li>
</ul>外からみえたら困るので、やっぱりアクセスが禁止されている。

</div>
<div class="section">
    #### 名前が「_」から始まるファイルにはアクセスできない
    <img src="http://cdn-ak.f.st-hatena.com/images/fotolife/d/daruyanagi/20120706/20120706164127.png" alt="f:id:daruyanagi:20120706164127p:plain" title="f:id:daruyanagi:20120706164127p:plain" class="hatena-fotolife"/>

<ul>
<li>**_AppStart.cshcml**：アプリケーションが起動するとき一度だけ実行される（グローバル変数の初期化、Web サービスの API キー格納など）</li>
<li>**_PageStart.cshtml**：配置されたフォルダ以下にあるページが表示されるごとに実行される（レイアウトの指定やキャッシュコントロール、アクセス制御など）</li>
</ul>正直なところ _PageStart.cshtml でアクセス制御ができるのは知らなかったかも。今度使っちゃおう。
```cs
@{
    Response.CacheControl = "no-cache";
 
    if (!WebSecurity.IsAuthenticated) {
        Response.Redirect("~/Account/Login");
    }
}

```
<ul>
<li><a href="http://msdn.microsoft.com/ja-jp/asp.net/hh180208.aspx">第 18 章 サイト全体の動作をカスタマイズする | Razor 構文と ASP.NET Web ページ</a></li>
</ul>そのほか、レイアウトファイル（たとえば“_Layout.cshtml”）や部分ビュー（たとえば“_Partial.cshtml”）も、外部に公開する必要はないので名前の先頭に「_」をつけることが多い。また、一時的に Web ページを非公開にする場合にも、リネームだけで対応できるので便利。ちなみに、コードからはちゃんとアクセスできるのでご安心を。

</div>
</div>
<div class="section">
    ### 名前の解決
    いくつかのルールはあるが、あまり難しくはない。工夫次第では URL をクール＆クリーンに保つことができる。

<div class="section">
    #### 静的な解決
    まずは、存在するファイル・フォルダへのアクセスの規則を確認する。

<div class="section">
    ##### 拡張子ありのファイルアクセス
    <img src="http://cdn-ak.f.st-hatena.com/images/fotolife/d/daruyanagi/20120706/20120706170046.png" alt="f:id:daruyanagi:20120706170046p:plain" title="f:id:daruyanagi:20120706170046p:plain" class="hatena-fotolife"/>あまり使わないが CSHTML (Razor C#) ファイルも“index.html”のように拡張子まで指定してアクセスできる。

</div>
<div class="section">
    ##### 拡張子なしのファイルアクセス
    <img src="http://cdn-ak.f.st-hatena.com/images/fotolife/d/daruyanagi/20120706/20120706170439.png" alt="f:id:daruyanagi:20120706170439p:plain" title="f:id:daruyanagi:20120706170439p:plain" class="hatena-fotolife"/>CSHTML (Razor C#) ファイルは拡張子を省くことも可能<a href="#f1" name="fn1" title="HTML ファイルなどは、拡張子を省くことができないようだ">*1</a>。こっちのほうがモダンかつクールかもしれない。

</div>
<div class="section">
    ##### ディレクトリへのアクセス
    <img src="http://cdn-ak.f.st-hatena.com/images/fotolife/d/daruyanagi/20120706/20120706170656.png" alt="f:id:daruyanagi:20120706170656p:plain" title="f:id:daruyanagi:20120706170656p:plain" class="hatena-fotolife"/>“index.html”などが表示される。優先順位は［サイト］－［設定］で変更できる。

</div>
</div>
<div class="section">
    #### 動的な解決 ―― UrlData[]
    <img src="http://cdn-ak.f.st-hatena.com/images/fotolife/d/daruyanagi/20120706/20120706171307.png" alt="f:id:daruyanagi:20120706171307p:plain" title="f:id:daruyanagi:20120706171307p:plain" class="hatena-fotolife"/>
```
/あ.cshtml/い/う/え/お
→ UrlData[] { "い", "う", "え", "お" }
```の「あ.cshtml」以降のパラメータを、 UrlDate[] 配列で受け取ることができる。<img src="http://cdn-ak.f.st-hatena.com/images/fotolife/d/daruyanagi/20120706/20120706171708.png" alt="f:id:daruyanagi:20120706171708p:plain" title="f:id:daruyanagi:20120706171708p:plain" class="hatena-fotolife"/>さらに、「お.cshtml」をリネームして「/あ/い/う/え/お.cshtml」による名前解決を無効にすれば、「あ.cshtml」の拡張子を省略することも可能。つまり、
```
/あ/い/う/え/お
→ UrlData[] { "い", "う", "え", "お" }
```が得られる。これを利用すれば、 WebMatrix でも URL を動的に扱える。ちなみに、クエリ文字列（ /?foo=bar&amp;hoge=hauhau など）は Request.QueryString で受け取ることができる。

</div>
</div><div class="footnote">
<a href="#fn1" name="f1" class="footnote-number">*1</a><span class="footnote-delimiter">:</span><span class="footnote-text">HTML ファイルなどは、拡張子を省くことができないようだ</span>
</div>

