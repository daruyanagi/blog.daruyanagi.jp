
+++
date = "2017-09-23 14:07:31 +0000 UTC"
draft = false
title = "Omawari 1.2.0.0：いわゆる Web 更新チェッカーだけど、細かいところを改善した"
tags = ["告知","Omawari","PowerShell"]

+++


{{< figure src="/images/20170923135951.png"  >}}

br/>


<ul>
<li>メインリストビューに Last Update 欄を設ける
<ul>
<li>それに伴うコード整理</li>
<li>Refresh ボタンは不要になったので廃止</li>
</ul></li>
<li>通知トレイで DEBUG モードなのがわかるように</li>
<li>ファイル操作の非同期化 （メイン画面を初期表示＆スクロールする際のカクツキを抑えた）
<ul>
<li>それに伴うリグレッションの修正</li>
<li>ついでにステータスバーに総稼働時間を表示するように</li>
</ul></li>
<li>リファクタリング</li>
<li>Click Once がめんどいのでやめた（ごめんなさい！）</li>
</ul>
<div class="github-card" data-user="daruyanagi/Omawari" data-repo="releases" data-width="400" data-height="" data-theme="default"></div

>
<script src="https://cdn.jsdelivr.net/github-cards/latest/widget.js"></script>
<br/>


<div class="section">
    ### リリースアーカイブを毎回手で作るの面倒くさくなったので PowerShell にした
    

{{< figure src="/images/20170923140119.png"  >}}

lickOnce って Web サーバーでホストしない場合、更新するのにいちいち古いバージョンのアンインストールが必要になって大変面倒くさいので、単に ZIP アーカイブでまとめて配布するようにした。そのパッケージを毎回手で作るのは面倒なので、PowerShell でアーカイブを作るスクリプトを描いた。
```ps1
# 起点となる bin フォルダー
$root = Join-Path $PSScriptRoot "Omawari\bin"

# 入力フォルダー
$src = Join-Path $root "Release"

# 出力フォルダー
$version = (Get-ItemProperty (Join-Path $src "Omawari.exe")).VersionInfo.FileVersion
$dest = Join-Path $root Omawari-$version.zip

# ZIP で圧縮
Compress-Archive -Path $src/* -DestinationPath $dest

# フォルダーを開く
Invoke-Item $root

```リリースビルドの実行ファイルのバージョンを読んで Omawari-*.*.*.*.zip という名前の ZIP アーカイブに圧縮するだけ。この程度の<br/>
 PowerShell なら割と書けるようになってきた！（バージョンの取得の仕方はググったけど……）コレでもアップデートは面倒なので、Chocolatey パッケージにすることも画策してる。

{{< tweet 911375028125556736 >}}

</div>

