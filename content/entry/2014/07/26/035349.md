
+++
date = "2014-07-26 03:53:49 +0000 UTC"
draft = false
title = "WebMatrix 3：サイトをライブタイルに対応させてみた"
tags = ["Internet Explorer","WebMatrix"]

+++
{{< figure src="/images/20140726031239.png"  >}}Windows 8.1 で（Windows 8 は切り捨てた）<a href="http://daruyanagi.net/">http://daruyanagi.net/</a> をスタート画面へピン留めすると、こんな感じになるハズ。前々からやってみたかったのだけど、なかなか腰が上がらなかった。

<div class="section">
    ### 用意するもの
    {{< figure src="/images/20140726033408.png"  >}}<br/>


<ul>
<li>browserconfig.xml
<ul>
<li>この名前でなくてもいいが、その場合はメタタグに名前を記述</li>
</ul></li>
<li>通知タイルを定義した XML ファイル
<ul>
<li>browserconfig.xml の notifications 属性に記述。必須ではないが、用意しておくとタイルがくるくる切り替わるようになる</li>
<li>今回はデータベースをもとに Notifications.cshtml で動的に生成</li>
<li>最大5つまで</li>
</ul></li>
<li><code>&lt;meta name="application-name" content="アプリ名"/></code>
<ul>
<li>レイアウトファイルに一行挿入</li>
<li>browserconfig.xml の内容をメタタグとして埋め込むスタイルもあるが、今回は分離しておく。はてなブログをタイルに対応させる場合は、ヘッダーへメタタグを記述する方式がよさそう</li>
</ul></li>
<li>tiny、square、wide、large の各サイズ向けタイル画像
<ul>
<li>今回は青色に塗りつぶしただけのシンプルなものを用意</li>
<li>タイルの背景に使う tile.jpg も準備しておいた（「画像は .JPG、.GIF、.PNG 形式のファイルであり、容量を 200 KB 未満、サイズを 1024 x 1024 ピクセル未満にする必要があります。」とのこと）</li>
</ul></li>
</ul>
<table>
    <tbody><tr>
    <td>タイルのサイズ	</td>
    <td>標準のタイルのサイズ	</td>
    <td>最小画像サイズ	</td>
    <td>推奨される画像のサイズ</td>
    </tr>
    <tr>
    <td>小サイズ	</td>
    <td>70 x 70	</td>
    <td>56 x 56	</td>
    <td>128 x 128</td>
    </tr>
    <tr>
    <td>普通サイズ	</td>
    <td>150 x 150	</td>
    <td>120 x 120	</td>
    <td>270 x 270</td>
    </tr>
    <tr>
    <td>ワイド サイズ	</td>
    <td>310 x 150	</td>
    <td>248 x 120	</td>
    <td>558 x 270</td>
    </tr>
    <tr>
    <td>大サイズ	</td>
    <td>310 x 310	</td>
    <td>248 x 248	</td>
    <td>558 x 558</td>
    </tr>
</tbody></table>
</div>
<div class="section">
    ### browserconfig.xml
    こんな感じで記述
```xml
<!--?-->xml version="1.0" encoding="utf-8"?>
<browserconfig></browserconfig>
  <msapplication></msapplication>
    <tile></tile>
      src="tiny.png"/>
      src="square.png"/>
      src="wide.png"/>
      src="large.png"/>
      <tilecolor></tilecolor>#007fff // “aliceblue”なんかは使えない鴨
    
    <notification></notification> // 必須ではない。まずはこれなしで動くかテストすることをお勧め
      src="http://daruyanagi.net/Notifications/0"/>
      src="http://daruyanagi.net/Notifications/1"/>
      src="http://daruyanagi.net/Notifications/2"/>
      src="http://daruyanagi.net/Notifications/3"/>
      src="http://daruyanagi.net/Notifications/4"/>
      <frequency></frequency>30 // 30、60、360、720、1440 のいずれか
      <cycle></cycle>1 // 0 ～ 7 のいずれか
    
  


```cycle 属性の値はこんな感じ。

<ul>
<li>0: (通知が 1 つだけの場合の既定値) 循環しません。</li>
<li>1: (通知が複数ある場合の既定値) すべてのタイルのサイズで通知を循環します。</li>
<li>2: 普通サイズのタイルに対する通知のみを循環します。</li>
<li>3: ワイド タイルに対する通知のみを循環します。</li>
<li>4: 大きいタイルに対する通知のみを循環します。</li>
<li>5: 普通サイズのタイルやワイド タイルに対する通知のみを循環します。</li>
<li>6: 普通サイズのタイルや大きいタイルに対する通知のみを循環します。</li>
<li>7: ワイド タイルや大きいタイルに対する通知のみを循環します。</li>
</ul>ちゃんと規定値があるので、めんどくさいなら省いてもいいぐらい。

<ul>
<li><a href="http://msdn.microsoft.com/ja-jp/library/dn455106(v=vs.85).aspx">IE11 での Web サイト用カスタム タイルの作成 (Windows)</a></li>
</ul>
</div>
<div class="section">
    ### Notifications.cshtml
    小・ワイド・大の3つに対応したタイルスキーマを返しておく。テンプレートについては

<ul>
<li><a href="http://msdn.microsoft.com/ja-jp/library/dn456348(v=vs.85).aspx">Internet Explorer 11 でのライブ タイル テンプレートの選択 (Windows)</a></li>
</ul>を参照のこと。
```xml
@{
    Response.ContentType = "application/xml";

    dynamic item;

    using (var db = Database.Open(“***”))
    {
        item = db.Query("SELECT * From ***")
            .ElementAt(UrlData[0].AsInt(0));
    }
}
<tile></tile>
  lang="en-US" version="2">  
    template="TileSquare150x150PeekImageAndText04" branding="name">
      id="1" src="http://daruyanagi.net/Tile.jpg"/>
      id="1">@App.Title 
      id="2">@item.Title 
    

    template="TileWide310x150SmallImageAndText04" branding="logo">
      id="1" src="http://daruyanagi.net/Tile.jpg"/> 
      id="1">@App.Title 
      id="2">@item.Title 
    
 
    template="TileSquare310x310ImageAndTextOverlay02" branding="logo">
      id="1" src="http://daruyanagi.net/Tile.jpg"/>
      id="1">@App.Title 
      id="2">@item.Title 
    
  


```<a href="http://daruyanagi.net/Notifications/0">http://daruyanagi.net/Notifications/0</a> を叩くと
```xml
<tile></tile>
  lang="en-US" version="2">  
    template="TileSquare150x150PeekImageAndText04" branding="name">
      id="1" src="http://daruyanagi.net/Tile.jpg"/>
      id="1">@daruyanagi 
      id="2">Surface Pro 3：COM Surrogate や Peer Name Resolution Protcol が妙にリソースを食っている 
    

    template="TileWide310x150SmallImageAndText04" branding="logo">
      id="1" src="http://daruyanagi.net/Tile.jpg"/> 
      id="1">@daruyanagi 
      id="2">Surface Pro 3：COM Surrogate や Peer Name Resolution Protcol が妙にリソースを食っている 
    
 
    template="TileSquare310x310ImageAndTextOverlay02" branding="logo">
      id="1" src="http://daruyanagi.net/Tile.jpg"/>
      id="1">@daruyanagi 
      id="2">Surface Pro 3：COM Surrogate や Peer Name Resolution Protcol が妙にリソースを食っている 
    
  


```が返る。branding 属性はタイル左下に表示される項目を指定するもので、規定は name のようだ。logo にしておくと favicon が表示される。これで準備は完了のはず。

</div>
<div class="section">
    ### 注意する点。
    
<ul>
<li>画像へのパスが間違ってるとライブタイルは更新されない</li>
<li>パスの指定はドメインを含めたすべてを指定しなければならないようだ</li>
<li>タイルの version 1 は要らない</li>
<li>フォールバック（fallback）属性を書くと、ライブタイルは動作しない</li>
</ul>とくに最後の項目は <a href="http://msdn.microsoft.com/ja-jp/library/hh761491.aspx">タイル テンプレート カタログ (Windows ランタイム アプリ) - Windows app development</a> からコードをコピペした場合に注意。
```xml
<tile></tile>
  <visual></visual>
    template="TileSquarePeekImageAndText02">
      id="1" src="image1" alt="alt text"/>
      id="1">Text Field 1 (larger text)
      id="2">Text Field 2
      
  


<tile></tile>
  version="2">
    template="TileSquare150x150PeekImageAndText02" fallback="TileSquarePeekImageAndText02">
      id="1" src="image1" alt="alt text"/>
      id="1">Text Field 1 (larger text)
      id="2">Text Field 2
      
  


```これをコピペしても動かない。正しくはこんな感じ。
```xml
<tile></tile>
  version="2">
    template="TileSquare150x150PeekImageAndText02">
      id="1" src="image1" alt="alt text"/>
      id="1">Text Field 1 (larger text)
      id="2">Text Field 2
      
  


```
</div>

