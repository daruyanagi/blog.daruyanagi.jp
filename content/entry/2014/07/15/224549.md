
+++
date = "2014-07-15 22:45:49 +0000 UTC"
draft = false
title = "WebMatrix：ローカルとリモートで異なる設定を利用する方法を考えてみた"
tags = ["ASP.net Web Pages","WebMatrix"]

+++
たとえば Twitter BOT を作っている場合に、

<ul>
<li>ローカルテスト中は、テスト用に作成したアカウントでポスト</li>
<li>リモート展開中は、本番用のアカウントでポスト</li>
</ul>したい。<a href="http://msdn.microsoft.com/ja-jp/library/dd465318(v=vs.100).aspx">Visual Studio だったらデプロイ時に XDT で Web.config を書き換えられる</a>ので簡単だけど、わしはそれを WebMatrix でやりたいのさ。で、AppSettings についていろいろ調べてたのだけど……

    >
        

    ##### file 属性
    カスタム アプリケーションの構成設定を含む外部ファイルへの相対パスを指定します。指定されたファイルには、、、および  の各要素で指定されたものと同じ種類の設定が含まれ、これらの要素と同じキーと値のペア形式を使用します。指定するパスはメイン構成ファイルへの相対パスです。Windows フォーム アプリケーションの場合は、アプリケーションの構成ファイルの場所ではなく、バイナリ フォルダ (/bin/debug など) になります。Web フォーム アプリケーションの場合は、web.config ファイルが置かれているアプリケーション ルートへの相対パスになります。
**指定されたファイルが見つからない場合、ランタイムはこの属性を無視します。**


        <appsettings> 要素
    </appsettings>
これは使えそう。方針はこんな感じ。

<ul>
<li>ローカルテスト時：Web.config（テスト用の Twitter アカウントの設定を記述）</li>
<li>リモートテスト時：Web.config ＋ RemoteOnly.config（本番用の Twitter アカウントの設定で上書き）</li>
</ul>発行のときにリモートの RemoteOnly.config を消さないように気を付けなきゃいけない運用上の注意はあるけれど、これは割とイケるのではないか。

<div class="section">
    ### Web.config
    appSettings にテスト用アカウントの設定を記述。
```xml
<!--?-->xml version="1.0" encoding="utf-8"?>

<configuration></configuration>
    .web>
        debug="true" targetFramework="4.0" />
        mode="Off" />
    .web>

    file="RemoteOnly.config"> // &lt;-- file 属性を記述
        &lt;add key="twitterAccessToken" value=""/>
        key="twitterAccessTokenSecret" value=""/>
        key="twitterConsumerKey" value=""/>
        key="twitterConsumerSecret" value=""/>
    


```RemoteOnly.config がない場合は、ConfigurationManager.AppSettings["***"] こちらの設定が取得される。<br/>
<br/>


</div>
<div class="section">
    ### RemoteOnly.config
    本番用アカウントの設定を記述。
```xml
<!--?-->xml version="1.0" encoding="utf-8"?>

<appsettings></appsettings>
    key="twitterAccessToken" value=""/>
    key="twitterAccessTokenSecret" value=""/>
    key="twitterConsumerKey" value=""/>
    key="twitterConsumerSecret" value=""/>


```上書きする appSettings をルートに書けばいいんだね。

</div>

