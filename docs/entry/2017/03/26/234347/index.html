<!DOCTYPE html>
<html><link rel="icon" href="https://via.placeholder.com/70x70">
<link rel="stylesheet" href="https://andybrewer.github.io/mvp/mvp.css">

<meta charset="utf-8">
<meta name="description" content="My description">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>はてなブログのドメインを daruyanagi.jp から blog.daruyanagi.jp へ引越しした - だるろぐ - だるやなぎのブログ</title>

<style>
    nav {
        margin-bottom: 0;
    }

    body {
        font-family: "UD デジタル 教科書体 NP-R", Arial, Helvetica, sans-serif;
    }

    table {
        margin: 2em auto;
        border: none;
    }

    th, td, tr {
        text-align: right !important;
        padding: 1rem !important;
    }

    td {
        border-bottom: 1px solid gray;
    }
</style>


    
        
        <script async src="https://www.googletagmanager.com/gtag/js?id=UA-53152247-5"></script>
        <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-53152247-5');
        </script>
    
<body>
        <header><nav>
    <a href="/"><img alt="Logo" src="/logo.png" height="70"></a>
    
</nav>

<h1>だるろぐ - だるやなぎのブログ</h1>

<p></p>



<hr></header>

        <main>
<article>
    <h1>はてなブログのドメインを daruyanagi.jp から blog.daruyanagi.jp へ引越しした</h1>
    
    <p class="published">
        <time>
            公開日：
            2017/03/26
        </time>        
    </p>

    <figure>
    <img src="/images/20170325190700.png"/> 
</figure>

<p>まり気付かれてない気がしますが（こっそりやったので！）、はてなブログのドメインをお引越ししました。はてなブログを独自ドメインにする話はよく見かけますが、独自ドメインで運用していたはてなブログを別のドメインへ移動させた例はあまりないかもしれないので、メモがてら残しておきます。とはいえ、心配したようなトラブルもとくに起こりませんでした。1時間ちょっと はてなブログ がダウンしたのと、AdSense がちょっと減ったような気がする程度です。</p>
<div class="section">
    ### 以前の状態と解決すべき課題
    以前は
<ul>
<li>daruyanagi**.net**：メインのブログ（WordPress）</li>
<li>daruyanagi**.jp**：はてなブログ</li>
</ul>という運用をしていたのですが（こういうちょっと謎な構造になっていたのは、もっぱら歴史的な事情によります）、WordPress よりも はてなブログの方が管理が楽だったこともあり、いつしか daruyanagi.jp がメインに。持て余していた daruyanagi.net をポートフォリオサイト（というか自己紹介サイト）っぽい感じにして使っていたのですが、とある日、ドメインの延長手続きを失念してしまい、daruyanagi.net を失ってしまいました。
<figure>
    <img src="/images/20170326230159.png"/> 
</figure>

<p>在は水素水を布教するサイトになっています。そんなわけで、</p>
<ul>
<li>daruyanagi.jp：はてなブログ</li>
<li>**about.**daruyanagi.jp：自己紹介サイト</li>
</ul>というよくわからない構造になってしまい、ちょっと困っていました。できればこれを
<ul>
<li>**blog.**daruyanagi.jp：はてなブログ</li>
<li>daruyanagi.jp：自己紹介サイト</li>
</ul>という感じに整理したかった。あと、トップドメインで はてなブログ を運用するのはあまりよくないので直したかった、というのもあります。
<pre><code>&gt;
    ※はてなブログでは、サブドメインを使用しないexample.comでブログを運用すると、ドメイン名の仕組み上、トラブルの原因になることがあります。取得したドメインの前に、必ずサブドメイン（wwwやblogなど）を付加してください。

    はてなブログを独自ドメインで利用する - はてなブログ ヘルプ
</code></pre>
<p>Twitter で煽られるのも悲しいですしね！</p>
<blockquote class="twitter-tweet"><p lang="ja" dir="ltr">RFC 違反ドメイン</p>&mdash; しばやん (@shibayan) <a href="https://twitter.com/shibayan/status/845588375209881600?ref_src=twsrc%5Etfw">March 25, 2017</a></blockquote>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>

<p>br/&gt;</p>
</div>
<div class="section">
    ### WebMatrix × ASP.NET Web Pages で自己紹介サイトを構築し、Azure へ配置する
    というわけで、サイトのお引越し処理です。やらなければいけないのは以下の2つになります。
<ol>
<li>はてなブログを daruyanagi.jp から blog.daruyanagi.jp へ移動
<ol>
<li>独自ドメインの割り当てを解除し、daruyanagi.hatenablog.com に戻す</li>
<li>DNS設定を行う</li>
<li>はてなブログに新しい独自ドメインを割り当てる</li>
</ol></li>
<li>自己紹介サイトを daruyanagi.jp にする
<ol>
<li>DNS設定を行う</li>
<li>Azure のカスタムドメイン機能で daruyanagi.jp を割り当てる</li>
</ol></li>
</ol>うちは20年近くバリュードメインですので、そこで DNS の設定を書き換えます。
<figure>
    <img src="/images/20170326233254.png"/> 
</figure>

<p>れが反映されるのを待って、はてなブログ と Azure 側でもドメインの設定をしました。はてなブログのドメイン移動は、反映までに少し時間がかかりましたが（1時間ちょい）、問題なく行えました。あまり期待していなかったんですが、はてなブックマークなどもちゃんと受け継がれたようです。さすが！<a href="#f-2bea128f" name="fn-2bea128f" title="スターはダメなんだっけ？　よくわかんないけどいいや">*1</a>しかし、以前に外部からいただいた はてなブログ へのリンクが、移転に伴い 404 になってしまうのはあまりいただけません。というわけで、自己紹介サイトを拡張し、blog.daruyanagi.jp へリダイレクトを行うことにしました。幸い、自己紹介サイトは WebMatrix × ASP.NET Web Pages で作ってあったので、そんなに難しくはなさそう。しかも幸運なことに、はてなブログ は記事を配信するディレクトリを一段深く掘ってあります（ドメイン直下ではない）。</p>
<pre><code>&gt;
    ※ディレクトリとして、はてなブログで使用しているaboutやarchiveなどを設定することはできません。

    記事を配信するディレクトリを変更する - はてなブログ ヘルプ
</code></pre>
<p>というわけで、<code>daruyanagi.jp/entry</code>、<code>daruyanagi.jp/archive</code>、<code>daruyanagi.jp/about</code> へのリクエストをそのまま <code>blog.daruyanagi.jp</code> の各ディレクトリへリダイレクトすればよさそう。</p>
<figure>
    <img src="/images/20170326232734.png"/> 
</figure>

<p>br/&gt;</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cs" data-lang="cs"><span style="color:#960050;background-color:#1e0010">#</span> ~/Entry.cs<span style="color:#960050;background-color:#1e0010">、</span> ~/Archive.cs<span style="color:#960050;background-color:#1e0010">、</span> ~/About.cs

<span style="color:#960050;background-color:#1e0010">@</span>{
    <span style="color:#66d9ef">var</span> url = App.Blog + Request.Url.PathAndQuery;

    Response.RedirectPermanent(url);
}

<span style="color:#960050;background-color:#1e0010">```</span>&lt;code&gt;App.Blog&lt;/code&gt; <span style="color:#960050;background-color:#1e0010">には、</span>blog.daruyanagi.jp <span style="color:#960050;background-color:#1e0010">が格納されています</span>&lt;a href=<span style="color:#e6db74">&#34;#f-e1a7f04d&#34;</span> name=<span style="color:#e6db74">&#34;fn-e1a7f04d&#34;</span> title=<span style="color:#e6db74">&#34;開発中は daruyanagi.jp にしていろいろテストしていました&#34;</span>&gt;*<span style="color:#ae81ff">2</span>&lt;/a&gt;<span style="color:#960050;background-color:#1e0010">。</span>&lt;a href=<span style="color:#e6db74">&#34;https://msdn.microsoft.com/ja-jp/library/system.web.httpresponse.redirectpermanent(v=vs.110).aspx&#34;</span>&gt;HttpResponse.RedirectPermanent <span style="color:#960050;background-color:#1e0010">メソッド</span> (System.Web)&lt;/a&gt; <span style="color:#960050;background-color:#1e0010">は</span> <span style="color:#ae81ff">301</span> <span style="color:#960050;background-color:#1e0010">リダイレクトを行ってくれるらしいです。楽ちんですね！</span> WebMatrix/ASP.NET Web Pages <span style="color:#960050;background-color:#1e0010">を使ってる人は少ないと思いますが、他の言語やフレームワーク、サーバーでも似たような感じの運用で対処できそうな気がします。フィードもリダイレクトしようかなと思いましたが、それはなんとなくやめました。ごめんなさい。購読してくれてる方は、</span>URL <span style="color:#960050;background-color:#1e0010">の登録をやり直してください。</span>&lt;a href=<span style="color:#e6db74">&#34;#f-a6c4b1b3&#34;</span> name=<span style="color:#e6db74">&#34;fn-a6c4b1b3&#34;</span> title=<span style="color:#e6db74">&#34;daruyanagi.jp/feed を登録している場合は、はてなブログと僕のもう一つのブログ（コラムのみ）の新着情報の両方を受け取れます&#34;</span>&gt;*<span style="color:#ae81ff">3</span>&lt;/a&gt;Azure <span style="color:#960050;background-color:#1e0010">のカスタムドメイン割り当ては、はてなブログの独自ドメイン設定よりも早く、</span><span style="color:#ae81ff">30</span><span style="color:#960050;background-color:#1e0010">分弱で反映されました。うまくいってるみたいでよかったです。</span>Google <span style="color:#960050;background-color:#1e0010">はすぐに古い</span> URL <span style="color:#960050;background-color:#1e0010">を参照しなくなりましたが（</span>RedirectPermanent <span style="color:#960050;background-color:#1e0010">のおかげでしょうか？）、まだ古い</span> URL <span style="color:#960050;background-color:#1e0010">からくるトラフィックもあるみたいで、残念な思いをさせなくてよかったと思います（ブログを読んでがっかりするのは防げませんが！）。</span>

<figure>
    <img src="/images/20170326233705.png"/> 
</figure>


<span style="color:#960050;background-color:#1e0010">一日様子を見てから、</span>daruyanagi.jp -&gt; Azure <span style="color:#960050;background-color:#1e0010">も</span> cname <span style="color:#960050;background-color:#1e0010">ではなく</span> a <span style="color:#960050;background-color:#1e0010">レコードで引くようにしてみました。これで今回のミッションは完了！</span>　<span style="color:#960050;background-color:#1e0010">お疲れさまでした。</span>WebMatrix <span style="color:#960050;background-color:#1e0010">は今年いっぱいでサポート終了ですけど、最後まで役に立ってくれました。僕のようなアマチュアにはピッタリなツールだったのですが、やっぱり</span> Visual Studio Code <span style="color:#960050;background-color:#1e0010">などと比べてエディターが弱いので仕方がないかな。ともあれ、ありがとうと言いたいです。</span>

&lt;/div&gt;
&lt;div class=<span style="color:#e6db74">&#34;section&#34;</span>&gt;
    <span style="color:#960050;background-color:#1e0010">###</span> <span style="color:#960050;background-color:#1e0010">追記</span>
    

<blockquote class="twitter-tweet"><p lang="ja" dir="ltr"><a href="https://t.co/yNcU3LEMXE">https://t.co/yNcU3LEMXE</a> を売る相手がいなくなったので、水素水サイトにするか</p>&mdash; しばやん (@shibayan) <a href="https://twitter.com/shibayan/status/846011368872427520?ref_src=twsrc%5Etfw">March 26, 2017</a></blockquote>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>


&lt;/div&gt;&lt;div class=<span style="color:#e6db74">&#34;footnote&#34;</span>&gt;
&lt;a href=<span style="color:#e6db74">&#34;#fn-2bea128f&#34;</span> name=<span style="color:#e6db74">&#34;f-2bea128f&#34;</span> class=<span style="color:#e6db74">&#34;footnote-number&#34;</span>&gt;*<span style="color:#ae81ff">1</span>&lt;/a&gt;&lt;span class=<span style="color:#e6db74">&#34;footnote-delimiter&#34;</span>&gt;:&lt;/span&gt;&lt;span class=<span style="color:#e6db74">&#34;footnote-text&#34;</span>&gt;<span style="color:#960050;background-color:#1e0010">スターはダメなんだっけ？</span>　<span style="color:#960050;background-color:#1e0010">よくわかんないけどいいや</span>&lt;/span&gt;
&lt;a href=<span style="color:#e6db74">&#34;#fn-e1a7f04d&#34;</span> name=<span style="color:#e6db74">&#34;f-e1a7f04d&#34;</span> class=<span style="color:#e6db74">&#34;footnote-number&#34;</span>&gt;*<span style="color:#ae81ff">2</span>&lt;/a&gt;&lt;span class=<span style="color:#e6db74">&#34;footnote-delimiter&#34;</span>&gt;:&lt;/span&gt;&lt;span class=<span style="color:#e6db74">&#34;footnote-text&#34;</span>&gt;<span style="color:#960050;background-color:#1e0010">開発中は</span> daruyanagi.jp <span style="color:#960050;background-color:#1e0010">にしていろいろテストしていました</span>&lt;/span&gt;
&lt;a href=<span style="color:#e6db74">&#34;#fn-a6c4b1b3&#34;</span> name=<span style="color:#e6db74">&#34;f-a6c4b1b3&#34;</span> class=<span style="color:#e6db74">&#34;footnote-number&#34;</span>&gt;*<span style="color:#ae81ff">3</span>&lt;/a&gt;&lt;span class=<span style="color:#e6db74">&#34;footnote-delimiter&#34;</span>&gt;:&lt;/span&gt;&lt;span class=<span style="color:#e6db74">&#34;footnote-text&#34;</span>&gt;daruyanagi.jp/feed <span style="color:#960050;background-color:#1e0010">を登録している場合は、はてなブログと僕のもう一つのブログ（コラムのみ）の新着情報の両方を受け取れます</span>&lt;/span&gt;
&lt;/div&gt;

</code></pre></div>
</article>

<section>
    <style>
        article p.published { text-align: right; }

        .spacer { margin: auto 1em;}
    </style>

    <p>
        
        <a href="https://blog.daruyanagi.jp/entry/2017/03/25/201141/">&laquo; Older</a>
        
        <span class="spacer">|</span>
        <a href="/">Home</a>
        <span class="spacer">|</span>
        <a href="#">Top</a>
        <span class="spacer">|</span>
        
            <a href="https://blog.daruyanagi.jp/entry/2017/03/28/193550/">Newer &raquo;</a>
        
    </p>    
    
</section>


        </main>
        
        <footer><hr>
<p>
    <a href="/about">daruyanagi</a> &copy; 2007-2020
</p></footer>
    </body>
</html>
