
+++
date = "2014-09-08 00:33:44 +0000 UTC"
draft = false
title = "はてなブログが oEmbed に対応したらしいので WebMatrix で使ってみる"
tags = ["WebMatrix"]

+++
{{< figure src="/images/20140908003018.png"  >}}<br/>


<ul>
<li><a href="http://staff.hatenablog.com/entry/2014/09/03/153938">はてなブログoEmbed APIを公開しました。ブログカードの情報をAPIで取得できます（開発者向け） - はてなブログ開発ブログ</a></li>
</ul>せっかくなので、WebMatrix のヘルパーにしてトップページでも使ってみた。
```cs
# ~/App_Code/OEmbed.cshtml

@helper Hatena (string url) {
    try
    {
        using (var downloader = new WebClient())
        {
            var request = string.Format(
                "http://hatenablog.com/oembed?url={0}&amp;format={1}",
                url, "json"
            );

            var oembed_data = downloader.DownloadString(request);
            var oembed_json = Json.Decode(oembed_data);

            @Html.Raw(oembed_json.html);

            // @ObjectInfo.Print(oembed_json)
        }
    }
    catch (Exception e)
    {
        &lt;p class=&#39;error&#39;>@url: @e.Message&lt;/p>
    }
}

```使い方はこんな感じ。ちゃんと運用するなら WebCache とか使って少し高速化してみるのもいいかもしれない。
```cs
@OEmbed.Hatena("https://blog.daruyanagi.jp/entry/2014/07/03/035624")

```{{< figure src="/images/20140908003132.png"  >}}はてなブログのところだけデザインがカッコよくて違和感があるけれど、まぁ、とりあえずこれで。 {{< figure src="/images/20140908003322.png"  >}}@ObjectInfo.Print() を有効化してみると JSON でもらえる値がわかるので、これを利用して周りにフィットするようにダサくカードをデザインし直してもいいな（何


