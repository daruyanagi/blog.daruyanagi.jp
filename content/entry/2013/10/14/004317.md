
+++
date = "2013-10-14 00:43:17 +0000 UTC"
draft = false
title = "WebMatrix 3"
tags = ["WebMatrix","ASP.net Web Pages"]

+++


{{< figure src="/images/20131014003724.png"  >}}

的に画像を出力したい、という場合はこんな感じでいいのかな。以下は「~/Download/あほー」にアクセスると、「あほー」と描かれた画像を出力する例。
```cs
@using System.Drawing

@{
    var text = UrlData[0] == string.Empty ? "Sample" : UrlData[0];

    try
    {
        var bitmap = new Bitmap(600, 480);

        using (var g = Graphics.FromImage(bitmap)) {
        using (var font = newFont("Meiryo", 24)) 
        {
            var rect = new RectangleF(0, 0, 600, 480);
            var format = StringFormat.GenericDefault;
            format.Alignment = StringAlignment.Center;
            format.LineAlignment = StringAlignment.Center;

            g.FillRectangle(
                Brushes.CornflowerBlue,
                rect
            );

            g.DrawString(
                text, font, 
                Brushes.AntiqueWhite,
                rect, format
            );
        } }

        bitmap.Save(
            Response.OutputStream,
            Imaging.ImageFormat.Png
        );

        Response.ContentType = "image/png";
        Response.Flush();
        Response.End();
    }
    catch (Exception e)
    {
        Response.ContentType = "text/plain";
        Response.Write(e);
        Response.End();
    }
}

```

{{< figure src="/images/20131014003819.png"  >}}

係ないけれど、Razor だと using 句の {} が省略できない（if などのほかの制御文でも同じ）なので、using 句を連続して使う場合はネストが深くなる。仕方ないけれど、気持ち悪い。

