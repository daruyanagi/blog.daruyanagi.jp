
+++
date = "2014-06-06 13:57:49 +0000 UTC"
draft = false
title = "インストール済みの Windows Store Apps を列挙する"
tags = ["Windows Runtime"]

+++
{{< figure src="/images/20140606135118.png"  >}}<br/>


<div class="section">
    ### 方針
    <a href="http://msdn.microsoft.com/ja-jp/library/windows/apps/br240968.aspx">PackageManager.FindPackagesForUser(String) Method (Windows)</a> を使えばよい――が、この API は Windows Store Apps では使うことができない。今回は Windows Desktop Apps （コンソール）からこの API を呼んでみる。

</div>
<div class="section">
    ### 準備
    {{< figure src="/images/20140606133749.png"  >}}適当にコードを書いて実行すると、

    >
        アセンブリ &#39;System.Runtime, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&#39; への参照を追加してください。

    
というエラーが出る。とりあえず System.Runtime を参照に追加しろということらしいがどうすればよいのだろう……と思ったら、<a href="http://www.atmarkit.co.jp/ait/articles/1304/26/news058_2.html">特集：デスクトップでもWinRT活用：開発者が知っておくべき、ライブラリとしてのWindowsランタイム (2/5) - ＠IT</a> に解決策があった。まとめると、{{< figure src="/images/20140606134302.png"  >}}プロジェクトを一度アンロードして……{{< figure src="/images/20140606134305.png"  >}} *.csproj ファイルを編集し……{{< figure src="/images/20140606134309.png"  >}}TargetPlatformVersion を 8.0 にする。
```xml
<!--?-->xml version="1.0" encoding="utf-8"?>
ToolsVersion="12.0" DefaultTargets="Build" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  Project="$(MSBuildExtensionsPath)\$(MSBuildToolsVersion)\Microsoft.Common.props" Condition="Exists(&#39;$(MSBuildExtensionsPath)\$(MSBuildToolsVersion)\Microsoft.Common.props&#39;)" />
  <propertygroup></propertygroup>
    :
    :
    <targetplatformversion></targetplatformversion>8.0 // &lt;-- この行を追加

```{{< figure src="/images/20140606134457.png"  >}}で、もう一度プロジェクトを読み込んで［参照の追加］をすると、{{< figure src="/images/20140606134515.png"  >}}［Windows］という欄ができている。今回は、パッケージ関連の API を利用するので Windows.Management と Windows.ApplicationModel を参照に追加。さらに、最初のビルドエラーで要求されていた System.Runtime も参照に追加しておく。{{< figure src="/images/20140606134654.png"  >}}“%ProgramFiles(x86)%\Reference Assemblies\Microsoft\Framework\.NETFramework\v4.5\Facades\System.Runtime.dll”ファイルを指定して参照に加える。これで準備は完了。

</div>
<div class="section">
    ### コード
    ```cs
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace Sample3
{
    using Windows.Management.Deployment;

    class Program
    {
        static void Main(string[] args)
        {
            var manager = new PackageManager();
            var packages = manager.FindPackagesForUser(string.Empty);

            foreach (var package in packages)
            {
                Console.WriteLine(package.DisplayName);
                Console.WriteLine(package.Id.Name);
                Console.WriteLine(package.Id.Publisher);
                Console.WriteLine(package.Id.FullName);
                Console.WriteLine(package.Id.FamilyName);
                Console.WriteLine(package.Id.Version.Major);
                Console.WriteLine(package.Id.Version.Minor);
                Console.WriteLine(package.Id.Version.Build);
                Console.WriteLine(package.Id.Version.Revision);
                Console.WriteLine(package.Description);
                Console.WriteLine(package.PublisherDisplayName);
                Console.WriteLine("---");
            }

            Console.ReadKey();
        }
    }
}

```適当にこんな感じにして実行。{{< figure src="/images/20140606135118.png"  >}}package.DisplayName や package.Description などが表示されないが、この情報はそもそも提供されていないらしい。がっかりだ。ただ、 <a href="https://github.com/luisrigoni/metro-apps-list">luisrigoni/metro-apps-list · GitHub</a> で示されているように、Win32 API で PRI を読むなどすれば取得できないこともないらしい。だいぶ面倒だな……。

<ul>
<li><a href="http://msdn.microsoft.com/ja-jp/library/windows/apps/jj552947.aspx">リソース管理システム (Windows)</a></li>
</ul>
</div>

