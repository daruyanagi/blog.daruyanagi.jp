
+++
date = "2014-08-12 19:49:54 +0000 UTC"
draft = false
title = "WebMatrix 3：oEmbed ヘルパーを作ってみた（２）"
tags = ["WebMatrix","ASP.net Web Pages"]

+++
<a href="https://blog.daruyanagi.jp/entry/2014/08/08/185357">WebMatrix 3：oEmbed ヘルパーを作ってみた - だるろぐ</a> の続き。今回は Flickr の埋め込みをやってみようかと思う。

<div class="section">
    ### ~/App_Code/OEmbed.cshtml
    ```cs
@helper Flickr(string url) {
    const string API_ENDPOINT = "http://www.flickr.com/services/oembed/";

    using (var downloader = new WebClient())
    {
        try
        {
            // URL を組み立てて JSON の oEmbed データを取得
            var request = string.Format("{0}?url={1}&amp;format={2}", API_ENDPOINT, url, "json");
            var oembed_data = downloader.DownloadString(request);
            var oembed_json = Json.Decode(oembed_data);

            @ObjectInfo.Print(oembed_json) // デバッグのため

            var embed_type = oembed_json.type as string;

            switch (embed_type) // photo と video の二種類がある
            {
                case "photo":
&lt;figure>
    &lt;img src=&#39;@oembed_json.url&#39; alt=&#39;@oembed_json.title&#39;>
    &lt;figcaption>
        &lt;img src=&#39;http://favicon.qfor.info/f/@oembed_json.provider_url&#39; />
        &lt;a href=&#39;@oembed_json.web_page&#39;>@oembed_json.title&lt;/a>
        by &lt;a href=&#39;@oembed_json.author_url&#39;>@oembed_json.author_name&lt;/a>
    &lt;/figcaption>
&lt;/figure>
                    break;
                case "video":
&lt;figure>
    @Html.Raw(oembed_json.html)
&lt;/figure>
                    break;
                default:
                    break;

            }
        }
        catch (Exception exception)
        {
            &lt;p class=&#39;error&#39;>@url: @exception.Message&lt;/p>
        }
    }
}

```
</div>
<div class="section">
    ### ~/Default.cshtml
    ```html


&lt;html lang="ja">
    &lt;head>
        &lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
        &lt;meta charset="utf-8" />
        &lt;title>マイ サイトのタイトル&lt;/title>
        &lt;link href="~/favicon.ico" rel="shortcut icon" type="image/x-icon" />
    &lt;/head>
    &lt;body>
        @OEmbed.Flickr("https://www.flickr.com/photos/daruyanagi/6219334657/")
        @OEmbed.Flickr("https://www.flickr.com/photos/dmartinie/5760711397/")
    &lt;/body>
&lt;/html>

```
</div>
<div class="section">
    ### 結果
    たとえば Photo の場合。Twitter のときみたいに html を返してくれないので、自分で組み立てる。{{< figure src="/images/20140812194342.png"  >}}<br/>

```html
&lt;figure>
    &lt;img src=&#39;https://farm7.staticflickr.com/6162/6219334657_ba91a4498d_z.jpg&#39; alt=&#39;SMSはやく使えるようになりたい&#39;>
    &lt;figcaption>
        &lt;img src=&#39;http://favicon.qfor.info/f/https://www.flickr.com/&#39; />
        &lt;a href=&#39;https://www.flickr.com/photos/daruyanagi/6219334657/&#39;>SMSはやく使えるようになりたい&lt;/a>
        by &lt;a href=&#39;https://www.flickr.com/photos/daruyanagi/&#39;>daruyanagi&lt;/a>
    &lt;/figcaption>
&lt;/figure>

```Video の場合。これは html があるのでそれを使う。{{< figure src="/images/20140812194506.png"  >}}<br/>

```html
&lt;figure>
    &lt;object type="application/x-shockwave-flash" width="500" height="281" data="https://www.flickr.com/apps/video/stewart.swf?v=145061" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"> &lt;param name="flashvars" value="intl_lang=en-us&amp;photo_secret=5f7c3bff83&amp;photo_id=5760711397&amp;flickr_show_info_box=true">&lt;/param> &lt;param name="movie" value="https://www.flickr.com/apps/video/stewart.swf?v=145061">&lt;/param> &lt;param name="bgcolor" value="#000000">&lt;/param> &lt;param name="allowFullScreen" value="true">&lt;/param>&lt;embed type="application/x-shockwave-flash" src="https://www.flickr.com/apps/video/stewart.swf?v=145061" bgcolor="#000000" allowfullscreen="true" flashvars="intl_lang=en-us&amp;photo_secret=5f7c3bff83&amp;photo_id=5760711397&amp;flickr_show_info_box=true" height="281" width="500">&lt;/embed>&lt;/object>
&lt;/figure>

```{{< figure src="/images/20140812194912.png"  >}}写真の方は CSS でいい感じにデコってみた。なかなかいいかも。

</div>

