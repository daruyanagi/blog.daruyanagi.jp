
+++
date = "2015-05-02 11:12:06 +0000 UTC"
draft = false
title = "はてなダイアリーで特定カテゴリーの記事をお知らせとしてトップに掲出する方法を考えてみた。"
tags = ["JavaScript "]

+++
{{< figure src="/images/20150502105752.png"  >}}これな。ドメイン失くしてごめんなさい的な告知を出しておきたかった。

<div class="section">
    ### カテゴリーのフィードを探す。
    まずはカテゴリーのフィードを探す。カテゴリーページを開いてソースを見ると……{{< figure src="/images/20150502110020.png"  >}}こんな風に書いてある。
```html
&lt;link rel="alternate" type="application/atom+xml" title="Atom"
href="https://blog.daruyanagi.jp/feed/category/%E5%91%8A%E7%9F%A5"/>
&lt;link rel="alternate" type="application/rss+xml" title="RSS2.0"
href="https://blog.daruyanagi.jp/rss/category/%E5%91%8A%E7%9F%A5"/>

```なんでもいいと思うのだけど、今回は RSS2.0 の方を使った。

</div>
<div class="section">
    ### JavaScript でフィードを取得して主力する
    Google Feed API を利用するのが一般的な方法らしい。

<ul>
<li><a href="https://developers.google.com/feed/v1/?hl=ja">Google Developers</a></li>
</ul>最初の1個だけ取得して、#target 要素を書き換えるようにしてみる。
```javascript
&lt;script type="text/javascript" src="http://www.google.com/jsapi">&lt;/script>
&lt;script type="text/javascript">
    function GetAnnouncement(target, url) {
        google.load("feeds", "1");

        function initialize() {
            var feed = new google.feeds.Feed(url);
            feed.setNumEntries(1);
            feed.load(function (result) {
                if (!result.error) {
                    var container = document.getElementById(target);
                    var feed = result.feed.entries[0];
                    var html = " + feed.link + "&#39;>" + feed.title + "";
                    container.innerHTML = html;
                } else {
                    console.log(result.error.code + ":" + result.error.message);
                }
            });
        }

        google.setOnLoadCallback(initialize);
    }

    GetAnnouncement("feed", "https://blog.daruyanagi.jp/rss/category/%E5%91%8A%E7%9F%A5");
&lt;/script>

&lt;span id="feed">ここにはいる&lt;/span>

```JavaScript 力が低い（ついでにスタイルシートとかもかいて、装飾しておくとよいかと。ソースコードの見た目？　んなもん気にしない。キャッシュが効いていて更新が遅いので、気になる人は URL の尻尾になんかランダムの値を足しておくといいかも。毎回フィードをとりに行くので、表示は遅くなるが。

</div>
<div class="section">
    ### はてなのトップに掲出する
    {{< figure src="/images/20150502110738.png"  >}}デザイン設定画面のヘッダーのところにさっきのソースコードをペタッと貼る。あとは見栄えをチェックして完了。

</div>

