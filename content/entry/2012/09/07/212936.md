
+++
date = "2012-09-07 21:29:36 +0000 UTC"
draft = false
title = "Twitter の埋め込みタイムラインを WebMatrix で利用する"
tags = ["ASP.net Web Pages","WebMatrix","Twitter"]

+++


{{< figure src="/images/20120907205420.png"  >}}

br/>


    >
        サイトの上に簡単にTwitterのタイムラインを表示できるツール「埋め込みタイムライン」の提供を始めました。ブログの隣に表示したり、＃ハッシュタグを使ったイベントのページに表示したり、スポーツの試合ページに参加選手のリストを使って選手のツイートを表示するなど、サイト上にリアルタイムのツイートを加えることができます。

        http://blog.jp.twitter.com/2012/09/blog-post.html
    


{{< figure src="/images/20120907205552.png"  >}}

っそく WebMatrix 2 RC版（！）で試してみよう。<a href="https://twitter.com/settings/widgets">Login on Twitter</a> でウィジェットを作って cshtml へ貼り付けてみる。

<div class="section">
    ### ちょっとした注意
    

{{< figure src="/images/20120907205557.png"  >}}

*ガッデム／(^o^)＼**貼りつけたスクリプトに @ が含まれているときは注意だね。 Razor はこれを処理すべき変数・メソッドと解釈するので、当然エラーになる。 @ をそのまま出力したい場合は、
```
@@daruyanagi    // -> "@daruyanagi" 
```と @ を重ねて書けばいい。

</div>
<div class="section">
    ### もちろんヘルパーにしてみる……
    と思ったけれど、結局わざわざウィジェットページへ行かなければならないので、ヘルパーにしてもあまり美味しくないと思った。
```cs
# ~/App_Code/Twitter.EmbededTimeline.chtml

@helper GetHtml(
    string id, string url, string text = null,
    int? width = null, int? height = null, string lang = null,
    string theme = null, string link_color = null,
    string[] related = null, string aria_polite = null)
{
    if (string.IsNullOrEmpty(text))
    {
        // URL を解析して適当なテキストを生成する処理
        // たとえば、
        // twitter.com/daruyanagi -> @daruyanagi からのツイート
    }

    &lt;a class="twitter-timeline" href="@url"
       data-widget-id="@id"
       data-theme="@theme"
       data-link-color=@link_color
       data-related="@string.Join(", @related)"
       data-aria-polite="@aria_polite"
       width="@width" height="@height" lang="@lang">@text&lt;/a>
}

```こんな感じで書いておいて、
```html


&lt;html lang="ja">
    &lt;head>
&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
        &lt;meta charset="utf-8" />
        &lt;title>マイ サイトのタイトル&lt;/title>

        // これを挿入しておく
        // Assets か RenderSection() でやるとよいけどこれはまた後ほど
        &lt;script id="twitter-wjs"
                src="//platform.twitter.com/widgets.js">&lt;/script>
    &lt;/head>
    &lt;body>
        @Twitter_EmbededTimeline.GetHtml(
            "244022447123333120",
            @"http://twitter.com/daruyanagi")
        @Twitter_EmbededTimeline.GetHtml(
            "244027379142492160",
            @"http://twitter.com/daruyanagi/favorites")
        @Twitter_EmbededTimeline.GetHtml(
            "244027809108987904",
            @"http://twitter.com/search?q=#corgi")
    &lt;/body>
&lt;/html>

```と使うんだけど、まぁ、結構微妙だよね。ウィジェット ID と URL の最低2つをコピってこなければならない。それだったら、何も考えずに<a href="#f-934456ce" name="fn-934456ce" title="@ のエスケープはしなきゃだけど">*1</a>吐かれた公式のコードを張ったほうがマシだ。

{{< figure src="/images/20120907212725.png"  >}}

しにウィジェット ID を使いまわしていろんなパラメーターを入れると、 IE がなにかお世話をしてくれるみたい。このメッセージは初めてみたかも。

</div>
<div class="section">
    ### おまけ
    ちなみに Twitter.EmbededTimeline.chtml のクラス名は、 . が _ に置き換えられて Twitter_EmbededTimeline になる。Visual Studio なんかの IntelliSense でみてみればわかるけど、これはほかの WebPage クラス（cshtml ファイル）でも同じみたい。
```cs
@Twitter_EmbededTimeline.GetHtml()

```これをちゃんと（？）
```cs
@Twitter.EmbededTimeline.GetHtml()

```みたいに呼びたい場合は、 ~/App_Code/Twitter/EmbededTimeline.chtml ってな感じにサブフォルダーへ分けてしまえば OK 。一手間かかるからちょっと面倒だけどね。
```xml
<!--?-->xml version="1.0"?>
<configuration></configuration>
    .web>
      <compilation></compilation>
         <codesubdirectories></codesubdirectories>
           directoryName="Twitter"/>
         
      
   .web>


```試してはないけど、こんな感じで動くんじゃないかな。

<ul>
<li><a href="https://blog.daruyanagi.jp/entry/2012/08/16/182105">App_Code でサブフォルダーを利用する - だるろぐ</a></li>
</ul>
</div><div class="footnote">
<a href="#fn-934456ce" name="f-934456ce" class="footnote-number">*1</a><span class="footnote-delimiter">:</span><span class="footnote-text">@ のエスケープはしなきゃだけど</span>
</div>

