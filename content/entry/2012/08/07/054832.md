
+++
date = "2012-08-07 05:48:32 +0000 UTC"
draft = false
title = "WebMatrix + ASP.NET Web Pages でキレイにコーディングしたい"
tags = ["WebMatrix","ASP.net Web Pages"]

+++
>
        Razor 構文を使用する ASP.NET Web Pages は web framework および WebMatrix の一部で、Windows を使用した Web サイトの構築で必要なすべてが含まれます。

        
	Download: Razor 構文を使用する ASP.NET Web Pages - Microsoft Download Center - Download Details

    
WebMatrix + ASP.NET Web Pages でキレイにコーディングしたいなぁ、と思うのだけれど、どうするのが正しいのかよくわからない。自分なりのテンプレみたいなのがほしいんだけれどね。

<div class="section">
    ### 設定の共通化
    まず、 Web サイト全体の設定は一元管理したい。たぶん、これは“_AppStart.cshtml”に記述するのが正しいのだろう。
```cs
@{
    App.Title = "daruyanagi.net";
    App.Author = "daruyanagi";
    App.Language = "ja";
    App.Encoding = "utf-8";
    App.Copyright = "Copyright © 2012 daruyanagi. All rights reserved.";
    App.Description = "This is the web site of Hidetoshi Yanagi a.k.a. daruyanagi.";
    App.Keyword = "daruyanagi";
}

```これでも十分に簡素だけれど、設定ファイルやデータベースからロードできるようにすればもっとクールかもしれない。<img src="http://cdn-ak.f.st-hatena.com/images/fotolife/d/daruyanagi/20120807/20120807050527.png" alt="f:id:daruyanagi:20120807050527p:plain" title="f:id:daruyanagi:20120807050527p:plain" class="hatena-fotolife"/>App（や、このあとにでてくる Page）は dynamic 型（WebPageExecutingBase.App<a href="#f1" name="fn1" title="WebPageExecutingBase は The base class for all Plan9 files (_pagestart, _appstart, and regular pages) らしいのだけれど、 Plan9 ってなんぞ。今度調べよう">*1</a>）なので、あらかじめメンバーを定義しておかなくても、あとからいろいろ追加できる。
```cs
@{ 
    AppState["customAppName"] = "Application Name"; 
} 

```ほんとは AppState というのを使うっぽいけど、まぁ、いいや。

</div>
<div class="section">
    ### レイアウトの共通化
    つぎは、 Web サイトのデザインの共通化。 HTML 5 でレイアウトファイル（“~/Views/Shared/_Layout.cshtml”）記述して、 jQuery / Modernizr / html5.js あたりのスクリプトをロードしておくのがモダンなやり方というものだろう。あと、リセット CSS で一度スタイルをリセットし、そのあとに独自の CSS を充てるようにした。ブラウザー幅によってデザインを変更するレスポンシブな部分を担当する CSS を切り分ければ、より一層メンテナンス性は上がるかも。ただ、あんまりファイル数は多くしたくないな。
```html
@{
    App.Title = App.Title ?? "Untitled Application";
    App.Language = App.Language ?? "en";
    App.Encoding = App.Encoding ?? "utf-8";
    Page.Title = Page.Title ?? "Untitled Page";
}


&lt;html lang="@App.Language">
    &lt;head>
        &lt;title>@Page.Title - @App.Title&lt;/title>
        
        &lt;meta charset="@App.Encoding" />
        &lt;meta name="description" content="@App.Description">
        &lt;meta name="keywords" content="@App.Keyword">
        &lt;meta name="author" content="@App.Author">
        &lt;meta name="copyright" content="@App.Copyright">
        &lt;meta name="genarator" content="Microsoft WebMatrix 2.0">
        &lt;meta name="viewport"
              content="width=device-width,initial-scale=1">

        &lt;link rel="stylesheet" href="~/Content/Reset.css" />
        &lt;link rel="stylesheet" href="~/Content/Site.css" />
        
        <!--[if lt IE 9]>-->
        <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <!--[endif]---->

        &lt;script src="http://code.jquery.com/jquery-latest.js">&lt;/script>
        &lt;script src="http://www.modernizr.com/downloads/modernizr-latest.js">&lt;/script>
    &lt;/head>
    &lt;body>
        &lt;header id="site-header">
@RenderPage("_Header.cshtml")    
        &lt;/header>

        &lt;nav id="site-nav">
@RenderPage("_Navigation.cshtml")    
        &lt;/nav>
        
        &lt;div id="site-content">
            &lt;article id="site-body">
@RenderBody()           
            &lt;/article>
            &lt;aside id="site-sidebar">
@RenderPage("_SideBar.cshtml")    
            &lt;/aside>
        &lt;/div>

        &lt;footer id="site-footer">
@RenderPage("_Footer.cshtml")    
        &lt;/footer>
    &lt;/body>
&lt;/html>

```冒頭は、“_AppStart.cshtml”で Title などを指定し忘れたときに、最低限のパラメータを指定しておくコード。今まで気づかなかったのだけれど、&lt;meta name="author" content="@App.Author"> で @App.Author が null だと、 content 属性は出力されず、 &lt;meta name="author"> だけが出力されるんだね。なかなか頭いいな。<img src="http://cdn-ak.f.st-hatena.com/images/fotolife/d/daruyanagi/20120807/20120807042822.png" alt="f:id:daruyanagi:20120807042822p:plain" title="f:id:daruyanagi:20120807042822p:plain" class="hatena-fotolife"/>ヘッダーやナビゲーション、サイドバー、フッターは外部ファイルに追い出した。ここらへんは「分割し、統治せよ（divide et impera）」<a href="#f2" name="fn2" title="http://www.kitashirakawa.jp/taro/2011/05/divide-et-impera/">*2</a>ってやつですな。
```html
@{
    Layout = "~/Views/Shared/_Layout.cshtml";

    Page.Title = "Default";
}
&lt;p>Web ページの内容。&lt;/p>

```あとは、こんな感じで @RenderBody() でレンダリングする内容を記述すればいいというわけ。ページ固有のデータは、 dynamic 型の変数 Page に格納しておくことができる。
```
@{ 
    PageData["Color1"] = "Red"; 
    PageData["Color2"] = "Blue"; 
} 
```PageData （IDictionary<object, dynamic="">）に入れてもいいっぽい。 Page.Title にいれた値は、 PageData["Title"] で取り出せるし、たぶんその逆も可なので好きなほうを使うといい。もしかしたらパフォーマンス的な違いがあるのかもしれないけれど。</object,>あとはこれを適当に CSS で装飾すると、こんな感じになる。<img src="http://cdn-ak.f.st-hatena.com/images/fotolife/d/daruyanagi/20120807/20120807045124.png" alt="f:id:daruyanagi:20120807045124p:plain" title="f:id:daruyanagi:20120807045124p:plain" class="hatena-fotolife"/>

</div>
<div class="section">
    ### これからの目標
    今見返してふと思ったのは、比較的簡単にテーマ機能なんかを実装できるなということ。ただデザインを変えたいがために、毎回一からこんなの作るのはアホらしい。あと、 @RenderPage("_Footer.cshtml")  は @RenderFooter() などと記述できるとカッコいいな。「フッターはテーマフォルダ直下の“_Footer.cshtml”に書く」。なるべく規約ベースで。これも簡単にできそうだ。汎用的な部分はガンガン外に追い出して、再利用できるといい。

</div>
<div class="section">
    ### まとめ
    ASP.NET MVC はとてもすばらしい技術だと思うけれど、素人に毛の生えたレベルではどうもデカ過ぎる。その点、 ASP.NET Web Pages はちょうどいい。大規模なサービスを作ろうと思うとすぐぐちゃぐちゃになって破綻するけれど（そんな場合は MVC パターンの力を借りるべきだ）、“Template.html”をひたすらコピペして新しい記事を作るような個人サイトならば、 ASP.NET Web Pages で十分なんだ。サーバーを IIS にして、拡張子を html から cshtml にするだけでいい。たったこれだけで、 C# ＋ Razor を使ってキレイにコーディングできる。今から覚えるんだったら、 PHP より C# ＋ Razor のほうが簡潔かつ安全でいいと思うし。ドキュメントは、とりあえずこれを読んどけばいい。わしも全部は読んでないけれど、これの紙バージョンをもっていてたまに読んでいる。お盆休み中に、また復習してみようと思う。

<ul>
<li><a href="http://msdn.microsoft.com/ja-jp/asp.net/gg193039">Razor 構文と ASP.NET Web ページ</a></li>
</ul>あとは、しばやんのやる気を待つしかない。

<ul>
<li><a href="http://shiba-yan.hatenablog.jp/entry/20110714/1310652120">PHP と比較して覚える ASP.NET Web Pages (1) - しばやん雑記</a></li>
</ul>また、おいおい Razor に関しては備忘録をかねて書いていきたいと思うかも。

</div><div class="footnote">
<a href="#fn1" name="f1" class="footnote-number">*1</a><span class="footnote-delimiter">:</span><span class="footnote-text">WebPageExecutingBase は The base class for all Plan9 files (_pagestart, _appstart, and regular pages) らしいのだけれど、 Plan9 ってなんぞ。今度調べよう</span>
<a href="#fn2" name="f2" class="footnote-number">*2</a><span class="footnote-delimiter">:</span><span class="footnote-text">http://www.kitashirakawa.jp/taro/2011/05/divide-et-impera/</span>
</div>

