
+++
date = "2017-04-30 15:50:40 +0000 UTC"
draft = false
title = "PowerShell：スクレイピングすると“HRESULT からの例外:0x800A01B6”が発生する"
tags = ["PowerShell"]

+++
メインに使っているデスクトップ端末を Windows 10 Creators Update へアップデートしたのだけど、[PowerShell：ストアアプリのセール情報を取得する - だるろぐ](http://blog.daruyanagi.jp/entry/2017/03/04/220000)以前に作った PowerShell が動作しなくなった。
```ps1
$urls =@(
  "https://www.microsoft.com/ja-jp/store/p/nextgen-reader/9wzdncrfj262"
)

foreach ($url in $urls)
{
    try
    {
        $request = Invoke-WebRequest $url
        
        $body = $request.ParsedHtml
        $price_node = $body.getElementsByTagName("s") | where { 
            $_.getAttributeNode("class").Value  -eq "srv_saleprice"
        }　#&lt;-- ここで例外

```――結果。
```
HRESULT からの例外:0x800A01B6
```Internet Explorer（<code>Invoke-WebRequest()</code> などで内部的に利用されている）がメソッドをサポートしていないときにでるエラーみたい。

<div class="section">
    ### 解決
    <code>getElementsByTagName()</code> のかわりに <code>IHTMLDocument3_getElementsByTagName()</code> を用いる。以下のメソッドでも同様のエラーが出るので、適宜読み替える。
```
getElementsByTagName ->
IHTMLDocument3_getElementsByTagName 

getElementsByName ->
IHTMLDocument3_getElementsByName 

getElementByID ->
IHTMLDocument3_getElementByID
```
<ul>
<li><a href="https://www.sepago.com/blog/2016/05/03/powershell-exception-0x800a01b6-while-using-getelementsbytagname-getelementsbyname">PowerShell Exception 0x800A01B6 while using getElementsByTagName, getElementsByName or getElementByID | sepago</a></li>
</ul>
</div>
<div class="section">
    ### なぞ
    {{< figure src="/images/20170430154724.png"  >}}PowerShell スクリプトからではなく、PowerShell のシェルから <code>getElementsByTagName()</code> を使うとそのまま通った。よくわからんな……。

</div>

