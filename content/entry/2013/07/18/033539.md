
+++
date = "2013-07-18 03:35:39 +0000 UTC"
draft = false
title = "WebMatrix 3"
tags = ["WebMatrix","ASP.net Web Pages"]

+++
<a href="http://wsoembed.com/">Windows Store oEmbed API</a> は、なかなかいいですね。ブログにこんなかんじでストアアプリの情報が貼り付けられます。<iframe width="453" height="252" src="http://wsoembed.com/embed?id=24b07f02-446a-4861-b265-1d2fe4dd5383" frameborder="0"></iframe><iframe width="453" height="252" src="http://wsoembed.com/embed?id=86b6ecdc-e810-4aa2-9bdb-bb0da5b34737" frameborder="0"></iframe>使い方などは以下の URL を参照してください。

<ul>
<li><a href="http://shiba-yan.hatenablog.jp/entry/20130717/1373987475">Windows Store oEmbed API として公開しなおしました - しばやん雑記</a></li>
<li><a href="http://shiba-yan.hatenablog.jp/entry/20130716/1373916091">Windows ストアの内容を埋め込める oEmbed API を作った - しばやん雑記</a></li>
</ul>またストアアプリを作りたくなりました（ぁ

<div class="section">
    ### WebMatrix 3 で Windows Store oEmbed API を利用する
    <a href="http://shiba-yan.hatenablog.jp/entry/20130718/1374073617">Windows Store oEmbed API と jquery-oembed を組み合わせて使う方法 - しばやん雑記</a> のように JavaScript（クライアントサイド）で利用するのがよいと思いますが、C#（サーバーサイド）で使うこともできます。説明するのは面倒なので、コードだけおいておきます。APS.NET の“空のサイト”を作成し、Default.cshtml を以下のように編集してください。
```html
@{
    const string API_ENDPOINT = @"http://wsoembed.com/oembed";
    const string APP_URL = @"http://apps.microsoft.com/windows/ja-jp/app/86b6ecdc-e810-4aa2-9bdb-bb0da5b34737";
    
    var url = string.Format("{0}?url={1}", API_ENDPOINT, APP_URL);
    var response = string.Empty;

    using (var downloader = new WebClient(){ Encoding = System.Text.Encoding.UTF8 })
    {
        response = downloader.DownloadString(url);
    }

    var json_object = Json.Decode(response);
}



&lt;html lang="ja">
    &lt;head>
        &lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
        &lt;meta charset="utf-8" />
        &lt;title>マイ サイトのタイトル&lt;/title>
        &lt;link href="~/favicon.ico" rel="shortcut icon" type="image/x-icon" />
    &lt;/head>
    &lt;body>
        &lt;h1>Query&lt;/h1>
        &lt;p>@url&lt;/p>

        &lt;h1>JSON&lt;/h1>
        &lt;pre>
@response
        &lt;/pre>
        
        &lt;h1>json_object Member&lt;/h1>
        &lt;p>var json_object = Json.Decode(response);&lt;/p>
        &lt;ul>
        @foreach(var member in json_object.GetDynamicMemberNames())
        {
            &lt;li>json_object.@member&lt;/li>
        }
        &lt;/ul>
        
        &lt;h1>Html.Raw(json_object.html)&lt;/h1>
        @Html.Raw(json_object.html)
    &lt;/body>
&lt;/html>

```結果はこんなかんじです。{{< figure src="/images/20130718032449.png"  >}}API_ENDPOINT を叩けば JSON が返ってくるので、JSON ヘルパーを利用してオブジェクトにしてやりましょう。このオブジェクトは dynamic なので、json_object.html などとしてやれば値がとれます。大文字小文字に注意してね ☆（ゝω・）vｷｬﾋﾟ

</div>
<div class="section">
    ### Windows Store oEmbed API ヘルパー
    こんなコード、毎回書くのは面倒なので、ヘルパーにしてしまいましょう。ルートフォルダーに App_Code フォルダーを作成し、WindowsStore.cshtml を作成します。中身はこんな感じ。
```cs
@helper GetHtml(string app_id) {
    // app_id が url で渡されても許容する
    app_id = app_id.Split(&#39;/&#39;).Last();

    const string API_ENDPOINT = @"http://wsoembed.com/oembed";
    const string APP_BASEURL = @"http://apps.microsoft.com/windows/ja-jp/app/";
    
    var url = string.Format("{0}?url={1}", API_ENDPOINT, APP_BASEURL + app_id);

    using (var downloader = new WebClient(){ Encoding = System.Text.Encoding.UTF8 })
    {
        var response = downloader.DownloadString(url);
        var json_object = Json.Decode(response);

        @Html.Raw(json_object.html)
    }
}

```使い方はこんな感じ。Default.cshtml の最後の方にでも書き足してみてください。
```html
        :
        :
        &lt;h1>Helper&lt;/h1>
        @WindowsStore.GetHtml(APP_URL)

        @WindowsStore.GetHtml("86b6ecdc-e810-4aa2-9bdb-bb0da5b34737")
    &lt;/body>
&lt;/html>

```結果はこんなかんじです。{{< figure src="/images/20130718033142.png"  >}}ja-jp で決め打ちになっているのはアレなので、
```cs
@helper GetHtml(string app_id, string locale = "en-us") {
    ：
    ：

```みたいなシグネチャの方がいいのかもしれませんね。

</div>

