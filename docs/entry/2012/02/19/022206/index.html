<!DOCTYPE html>
<html><link rel="icon" href="https://via.placeholder.com/70x70">
<link rel="stylesheet" href="https://andybrewer.github.io/mvp/mvp.css">

<meta charset="utf-8">
<meta name="description" content="My description">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title> 危険な可能性のある Request.Form 値がクライアントから検出されました - だるろぐ - だるやなぎのブログ</title>

<style>
    nav {
        margin-bottom: 0;
    }

    body {
        font-family: "UD デジタル 教科書体 NP-R", Arial, Helvetica, sans-serif;
    }

    table {
        margin: 2em auto;
        border: none;
    }

    th, td, tr {
        text-align: right !important;
        padding: 1rem !important;
    }

    td {
        border-bottom: 1px solid gray;
    }
</style>


    
        
        <script async src="https://www.googletagmanager.com/gtag/js?id=UA-53152247-5"></script>
        <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-53152247-5');
        </script>
    
<body>
        <header><nav>
    <a href="/"><img alt="Logo" src="/logo.png" height="70"></a>
    
</nav>

<h1>だるろぐ - だるやなぎのブログ</h1>

<p></p>



<hr></header>

        <main>
<article>
    <p><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/d/daruyanagi/20120219/20120219013646.png" alt="f:id:daruyanagi:20120219013646p:plain" title="f:id:daruyanagi:20120219013646p:plain" class="hatena-fotolife"/>ASP.NET 規定の動作では、入力にHTMLタグが含まれていると、バリデーションでエラーを吐く（HttpRequestValidationException）。これはこれでありがたいのだけど、どうしてもHTMLタグを受け入れたい場合はある。</p>
<div class="section">
    ### ページ単位でバリデーションを無効にする
    web.config に設定を記述する。
<pre><code>```xml
</code></pre>
<p>&lt;configuration&gt;
&lt;system.web&gt;
&lt;httpRuntime requestValidationMode=&quot;2.0&rdquo; /&gt;
&lt;pages validateRequest=&quot;false&quot;&gt;
&lt;/pages&gt;
&lt;/system.web&gt;
&lt;/configuration&gt;</p>
<pre><code>
&lt;/div&gt;
&lt;div class=&quot;section&quot;&gt;
    ### メソッド単位でバリデーションを無効にする。
    POSTメソッドをまるごと。

    ```cs
[HttpPost]
[ValidateInput(false)]
public ViewResult Edit(FormCollection form)
{

}
</code></pre><p><a href="http://stackoverflow.com/questions/4361907/asp-net-mvc-3-validaterequestfalse-not-working-with-formcollection">ASP.NET MVC 3 ValidateRequest(false) not working with FormCollection - Stack Overflow</a></p>
</div>
<div class="section">
    ### フォームデータ単位でバリデーションを無効にする。
    Request クラスの拡張メソッド Unvalidated() を利用する。自分ではこれしか使わない。コントローラーで使ってみる。
<pre><code>```cs
</code></pre>
<p>using System.Web.Helpers;</p>
<p>var hoge = Request.Unvalidated().Form[&ldquo;hoge&rdquo;];</p>
<pre><code>ビューでも使えるんだね。

    ```
@Request.Unvalidated(&quot;html&quot;)

&amp;lt;form method=&quot;post&quot;&gt;
    &amp;lt;input type=&quot;text&quot; name=&quot;html&quot; /&gt;
    &amp;lt;input type=&quot;submit&quot; /&gt;
&amp;lt;/form&gt;
</code></pre><p><a href="http://d.hatena.ne.jp/shiba-yan/20110406/1302094656">System.Web.Helpers を活用する - まめしば雑記</a></p>
</div>
<div class="section">
    ### 補足
    DB に HTML タグを突っ込みたい場合は AllowHtml 属性を付与してやる。
<pre><code>```
</code></pre>
<p>[AllowHtml]
[DisplayName(&ldquo;本文&rdquo;)]
public string Body { get; set; }</p>
<pre><code>HTML タグを含む文字列を生のまま出力したい場合は、@Html.Raw() が利用できる。

    ```
@Html.Raw(hoge)
</code></pre><p>HTML タグを含む文字列を変数として保持したい場合は、 HtmlString/MvcHtmlString クラスを使う。MvcHtmlString は ASP.Net 3.5 MVC 2 から使えるが、 HtmlString は MVC 3 のみ。これからは HtmlString 使えばいいんじゃないかな。中身がどう違うのかはよく知らない。</p>
<pre><code>```
</code></pre>
<p>var hoge = new MvcHtmlString(&quot;&lt;b&gt;hoge&lt;/b&gt;&rdquo;);</p>
<pre><code>HTML タグを安全に出力したい場合は HttpUtility.HtmlEncode() を使う。

    ```
@HttpUtility.HtmlEncode(hoge)
</code></pre><p>※ 間違ってるところがあったら、ぜひ教えてほしいです&hellip;&hellip;</p>
</div>

</article>

<section>
    <style>
        .spacer { margin: auto 1em;}
    </style>

    <p>
        
        <a href="https://blog.daruyanagi.jp/entry/2012/02/18/234910/">&laquo; Older</a>
        
        <span class="spacer">|</span>
        <a href="/">Home</a>
        <span class="spacer">|</span>
        <a href="#">Top</a>
        <span class="spacer">|</span>
        
            <a href="https://blog.daruyanagi.jp/entry/2012/02/20/224419/">Newer &raquo;</a>
        
    </p>    
    
</section>


        </main>
        
        <footer><hr>
<p>
    <a href="/about">daruyanagi</a> &copy; 2007-2020
</p></footer>
    </body>
</html>
