
+++
date = "2017-04-01 00:46:09 +0000 UTC"
draft = false
title = "Microsoft Flow × だるやなぎ API で俺さまの年齢をつぶやく"
tags = ["Microsoft Flow","だるやなぎ"]

+++
Microsoft Flow は

<ul>
<li>API にアクセスして</li>
<li>データを解析し</li>
<li>それをツイートする</li>
</ul>といったこと（ロジックフローの連鎖）を簡単に実現できるサービスです。“あーして、こうして、そんでもってこうする！”みたいなのをダイアグラム的に書けるわけですね。あとでスクリーンショットをのせておくので見てほしいのですが、割とビジュアルでわかりやすいです。この Microsoft Flow はスタンドアロンで

<ul>
<li>定期的に</li>
<li>フィードが配信されたら</li>
</ul>みたいなトリガー（処理のきっかけ）を使うこともできますが、モバイルアプリを利用すれば**「このボタンを押すと」**をトリガーにすることができます。今回は だるやなぎ API を利用してモバイルアプリから年齢をつぶやく例を紹介します。毎日、僕の年齢を Twitter につぶやけて、とても便利です。

<div class="section">
    ### だるやなぎ API
    だるやなぎ API <a href="http://api.daruyanagi.jp/">http://api.daruyanagi.jp/</a> は、だるやなぎのさまざまな情報を取得できる API です。たとえば、<a href="http://api.daruyanagi.jp/?format=xml">http://api.daruyanagi.jp/?format=xml</a> を叩くと、
```xml
<object></object>
<name></name>YANAGI, Hidetoshi
<nickname></nickname>daruyanagi
<birth></birth>1980-04-20T09:00:00
<datetime></datetime>1998-04-20T09:00:00
<elapsed></elapsed>
<ticks></ticks>5679936000000000
<days></days>6574
<hours></hours>0
<milliseconds></milliseconds>0
<minutes></minutes>0
<seconds></seconds>0
<totaldays></totaldays>6574
<totalhours></totalhours>157776
<totalmilliseconds></totalmilliseconds>567993600000
<totalminutes></totalminutes>9466560
<totalseconds></totalseconds>567993600

<age></age>18
<ageatlastbirthday></ageatlastbirthday>18
<agebycalendaryear></agebycalendaryear>19
<married></married>false
<job></job>Oil King
<photos></photos>
https://onedrive.live.com/?authkey=%21ALMyzgcuZ67AAng&amp;id=2260696B6A4680D7%2118945&amp;cid=2260696B6A4680D7

<place></place>
<name></name>愛媛 松山市
<southwest></southwest>
<latitude></latitude>33.687285
<longitude></longitude>132.491125

<northeast></northeast>
<latitude></latitude>34.073779
<longitude></longitude>132.926666




```というデータが返ってきます。年齢や職業も一発ですね！　JSON 形式でも取得できるんですよ。

</div>
<div class="section">
    ### ざっとした使い方
    {{< figure src="/images/20170401003108.png"  >}}ますは <a href="https://flow.microsoft.com/ja-jp/">https://flow.microsoft.com/ja-jp/</a> からアプリをダウンロードします。iOS 版と Android 版があります。Windows 10 Mobile？……知らない子ですね。{{< figure src="/images/20170401002713.png" width="320px" >}} {{< figure src="/images/20170401002815.png" width="320px" >}}ダウンロードしたら、まずなにかフローを作成してみてください。わかんなかったらテンプレートがいっぱいあるので、なにか選んでみましょう。たとえばこの**“上司に今日は在宅勤務にするというメールを送信する”**なんて便利じゃないでしょうか。これを改造すれば、遅刻メールがワンボタンで送れるようになります。

</div>
<div class="section">
    ### Microsoft Flow に API を食わせる
    フローはモバイルアプリでも作れますが、個人的にはオンラインで作る方が好きです。画面がでかいので。{{< figure src="/images/20170401003551.png"  >}}今回作ったフローはこんな感じです。シンプルですね！　ほんとうは API が 200（成功）以外のレスポンスを返すことも考慮した方がよいでしょう。失敗したらメールで通知、みたいなのとか、どうでしょう？ポイントとなるのは、HTTP アクセスと――{{< figure src="/images/20170401003718.png"  >}}JSON の解析でしょうか。{{< figure src="/images/20170401003739.png"  >}}JSON の解析は一見難しそうですけど、サンプルの JSON データを一度食べさせると、それを解析し、他の処理に使いまわせるようにしてくれます。めっちゃ簡単ですね。{{< figure src="/images/20170401003854.png"  >}}だいたいこんな感じです。変数がビジュアルな感じで、わかりやすいと思います。{{< figure src="/images/20170401003944.png" width="320px" >}} {{< figure src="/images/20170401003958.png" width="320px" >}}フローを保存するとアプリにボタンが現れるので、さっそく押してみましょう。{{< tweet 847829505712336897 >}}ちゃんと 18歳 とツイートされました！

</div>
<div class="section">
    ### 補足
    
<ul>
<li>JSON データの解析・変数化は、階層まで考慮してくれません。異なる階層で同じ名前の変数があるとちょっと厄介（見分けがつかない</li>
<li>Twitter に紐づけられるアカウントの数は 2 つまでのようです。無料アカウントで3つ目を登録するとエラーがでます（言い忘れていましたが、**MicrosoftFlow は基本タダ**です。ただし、回数などに制限があります……が、個人利用ならそんなに気にしなくていいかな）</li>
<li>Twitter でつぶやくテキストは自由に編集できますが
<ul>
<li>スパム防止のために @ は削除されます（メンションできません</li>
<li>そもそも @ を使うとフローが壊れるっぽい</li>
</ul></li>
</ul>
</div>
<div class="section">
    ### P.S.
    この記事は 4月1日の午前中 に作成されました。

</div>

